{"remainingRequest":"D:\\study_room1\\study_room4\\study_room\\src\\main\\resources\\admin\\admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\study_room1\\study_room4\\study_room\\src\\main\\resources\\admin\\admin\\src\\views\\modules\\message\\tousu\\list.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\study_room1\\study_room4\\study_room\\src\\main\\resources\\admin\\admin\\src\\views\\modules\\message\\tousu\\list.vue","mtime":1766071027758},{"path":"D:\\study_room1\\study_room4\\study_room\\src\\main\\resources\\admin\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\study_room1\\study_room4\\study_room\\src\\main\\resources\\admin\\admin\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"D:\\study_room1\\study_room4\\study_room\\src\\main\\resources\\admin\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\study_room1\\study_room4\\study_room\\src\\main\\resources\\admin\\admin\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQgYXBpIGZyb20gJ0AvdXRpbHMvYXBpJw0KDQpleHBvcnQgZGVmYXVsdCB7DQogIG5hbWU6ICdDb21wbGFpbnQnLA0KICBkYXRhICgpIHsNCiAgICByZXR1cm4gew0KICAgICAgbG9hZGluZzogZmFsc2UsDQogICAgICBsaXN0OiBbXSwNCiAgICAgIHRvdGFsOiAwLA0KICAgICAgcGFnZTogeyBwYWdlOiAxLCBsaW1pdDogMTAgfSwNCiAgICAgIHE6IHsgY29tcGxhaW50Tm86ICcnLCBzdGF0dXM6IG51bGwsIGNhdGVnb3J5OiBudWxsIH0sDQoNCiAgICAgIGRldGFpbFZpc2libGU6IGZhbHNlLA0KICAgICAgZGV0YWlsOiBudWxsLA0KICAgICAgZXZpZGVuY2VVcmxzOiBbXSwNCg0KICAgICAgYXBwcm92ZVZpc2libGU6IGZhbHNlLA0KICAgICAgYXBwcm92ZUZvcm06IHsgaWQ6IG51bGwsIGhhbmRsZVN1bW1hcnk6ICcnIH0sDQoNCiAgICAgIHJlamVjdFZpc2libGU6IGZhbHNlLA0KICAgICAgcmVqZWN0Rm9ybTogeyBpZDogbnVsbCwgcmVqZWN0UmVhc29uOiAnJyB9LA0KDQogICAgICBoYW5kbGVyQWRtaW5JZDogdGhpcy5nZXRBZG1pbklkKCkNCiAgICB9DQogIH0sDQogIG1vdW50ZWQgKCkgew0KICAgIHRoaXMuZmV0Y2goKQ0KICB9LA0KICBtZXRob2RzOiB7DQogICAgLy8g5L2g5oyJ5a6e6ZmF55m75b2V5a2Y5YKo5a2X5q615pS55LiA5LiLDQogICAgZ2V0QWRtaW5JZCAoKSB7DQogICAgICB0cnkgew0KICAgICAgICBjb25zdCB1ID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndXNlcicpIHx8ICd7fScpDQogICAgICAgIHJldHVybiB1LmlkIHx8IHUudXNlcklkIHx8IDENCiAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgcmV0dXJuIDENCiAgICAgIH0NCiAgICB9LA0KICAgIGNhdGVnb3J5VGV4dCAodikgew0KICAgICAgY29uc3QgbSA9IHsgMTogJ+S5seWQg+S5seWWnScsIDI6ICflpKflo7Dllqflk5cnLCAzOiAn6ZqP5Zyw5aSn5bCP5L6/JywgNDogJ+WFtuS7licgfQ0KICAgICAgcmV0dXJuIG1bdl0gfHwgJ+acquefpScNCiAgICB9LA0KICAgIHN0YXR1c1RleHQgKHYpIHsNCiAgICAgIGNvbnN0IG0gPSB7IDA6ICflvoXlpITnkIYnLCAxOiAn5aSE55CG5LitJywgMjogJ+W3sue7k+ahiCcsIDM6ICflt7LpqbPlm54nIH0NCiAgICAgIHJldHVybiBtW3ZdIHx8ICfmnKrnn6UnDQogICAgfSwNCiAgICBzdGF0dXNUYWdUeXBlICh2KSB7DQogICAgICBpZiAodiA9PT0gMSkgcmV0dXJuICd3YXJuaW5nJw0KICAgICAgaWYgKHYgPT09IDIpIHJldHVybiAnc3VjY2VzcycNCiAgICAgIGlmICh2ID09PSAzKSByZXR1cm4gJ2RhbmdlcicNCiAgICAgIHJldHVybiAnJw0KICAgIH0sDQogICAgcmVzZXQgKCkgew0KICAgICAgdGhpcy5xID0geyBjb21wbGFpbnRObzogJycsIHN0YXR1czogbnVsbCwgY2F0ZWdvcnk6IG51bGwgfQ0KICAgICAgdGhpcy5wYWdlLnBhZ2UgPSAxDQogICAgICB0aGlzLmZldGNoKCkNCiAgICB9LA0KICAgIG9uU2l6ZUNoYW5nZSAocykgew0KICAgICAgdGhpcy5wYWdlLmxpbWl0ID0gcw0KICAgICAgdGhpcy5wYWdlLnBhZ2UgPSAxDQogICAgICB0aGlzLmZldGNoKCkNCiAgICB9LA0KICAgIG9uUGFnZUNoYW5nZSAocCkgew0KICAgICAgdGhpcy5wYWdlLnBhZ2UgPSBwDQogICAgICB0aGlzLmZldGNoKCkNCiAgICB9LA0KICAgIGFzeW5jIGZldGNoICgpIHsNCiAgICAgIHRoaXMubG9hZGluZyA9IHRydWUNCiAgICAgIHRyeSB7DQogICAgICAgIGNvbnN0IHBhcmFtcyA9IHsNCiAgICAgICAgICBwYWdlOiB0aGlzLnBhZ2UucGFnZSwNCiAgICAgICAgICBsaW1pdDogdGhpcy5wYWdlLmxpbWl0LA0KICAgICAgICAgIGNvbXBsYWludE5vOiB0aGlzLnEuY29tcGxhaW50Tm8sDQogICAgICAgICAgc3RhdHVzOiB0aGlzLnEuc3RhdHVzLA0KICAgICAgICAgIGNhdGVnb3J5OiB0aGlzLnEuY2F0ZWdvcnkNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBhcGkuY29tcGxhaW50UGFnZShwYXJhbXMpDQogICAgICAgIGlmIChyZXMuY29kZSAhPT0gMCkgcmV0dXJuIHRoaXMuJG1lc3NhZ2UuZXJyb3IocmVzLm1zZyB8fCAn5Yqg6L295aSx6LSlJykNCiAgICAgICAgdGhpcy5saXN0ID0gKHJlcy5kYXRhICYmIHJlcy5kYXRhLmxpc3QpIHx8IFtdDQogICAgICAgIHRoaXMudG90YWwgPSAocmVzLmRhdGEgJiYgcmVzLmRhdGEudG90YWwpIHx8IDANCiAgICAgIH0gZmluYWxseSB7DQogICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlDQogICAgICB9DQogICAgfSwNCiAgICBhc3luYyBvcGVuRGV0YWlsIChpZCkgew0KICAgICAgY29uc3QgcmVzID0gYXdhaXQgYXBpLmNvbXBsYWludEluZm8oaWQpDQogICAgICBpZiAocmVzLmNvZGUgIT09IDApIHJldHVybiB0aGlzLiRtZXNzYWdlLmVycm9yKHJlcy5tc2cgfHwgJ+iOt+WPluivpuaDheWksei0pScpDQogICAgICB0aGlzLmRldGFpbCA9IHJlcy5kYXRhLmNvbXBsYWludA0KICAgICAgdGhpcy5ldmlkZW5jZVVybHMgPSByZXMuZGF0YS5ldmlkZW5jZVVybHMgfHwgW10NCiAgICAgIHRoaXMuZGV0YWlsVmlzaWJsZSA9IHRydWUNCiAgICB9LA0KICAgIG9wZW5BcHByb3ZlIChpZCkgew0KICAgICAgdGhpcy5hcHByb3ZlRm9ybSA9IHsgaWQsIGhhbmRsZVN1bW1hcnk6ICcnIH0NCiAgICAgIHRoaXMuYXBwcm92ZVZpc2libGUgPSB0cnVlDQogICAgfSwNCiAgICBhc3luYyBkb0FwcHJvdmUgKCkgew0KICAgICAgY29uc3QgcmVzID0gYXdhaXQgYXBpLmNvbXBsYWludEFwcHJvdmUoew0KICAgICAgICBpZDogdGhpcy5hcHByb3ZlRm9ybS5pZCwNCiAgICAgICAgaGFuZGxlckFkbWluSWQ6IHRoaXMuaGFuZGxlckFkbWluSWQsDQogICAgICAgIGhhbmRsZVN1bW1hcnk6IHRoaXMuYXBwcm92ZUZvcm0uaGFuZGxlU3VtbWFyeQ0KICAgICAgfSkNCiAgICAgIGlmIChyZXMuY29kZSAhPT0gMCkgcmV0dXJuIHRoaXMuJG1lc3NhZ2UuZXJyb3IocmVzLm1zZyB8fCAn5aSE55CG5aSx6LSlJykNCiAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygn5bey6YCa6L+H5bm257uT5qGIJykNCiAgICAgIHRoaXMuYXBwcm92ZVZpc2libGUgPSBmYWxzZQ0KICAgICAgdGhpcy5mZXRjaCgpDQogICAgfSwNCiAgICBvcGVuUmVqZWN0IChpZCkgew0KICAgICAgdGhpcy5yZWplY3RGb3JtID0geyBpZCwgcmVqZWN0UmVhc29uOiAnJyB9DQogICAgICB0aGlzLnJlamVjdFZpc2libGUgPSB0cnVlDQogICAgfSwNCiAgICBhc3luYyBkb1JlamVjdCAoKSB7DQogICAgICBpZiAoIXRoaXMucmVqZWN0Rm9ybS5yZWplY3RSZWFzb24pIHJldHVybiB0aGlzLiRtZXNzYWdlLndhcm5pbmcoJ+ivt+Whq+WGmemps+WbnuWOn+WboCcpDQogICAgICBjb25zdCByZXMgPSBhd2FpdCBhcGkuY29tcGxhaW50UmVqZWN0KHsNCiAgICAgICAgaWQ6IHRoaXMucmVqZWN0Rm9ybS5pZCwNCiAgICAgICAgaGFuZGxlckFkbWluSWQ6IHRoaXMuaGFuZGxlckFkbWluSWQsDQogICAgICAgIHJlamVjdFJlYXNvbjogdGhpcy5yZWplY3RGb3JtLnJlamVjdFJlYXNvbg0KICAgICAgfSkNCiAgICAgIGlmIChyZXMuY29kZSAhPT0gMCkgcmV0dXJuIHRoaXMuJG1lc3NhZ2UuZXJyb3IocmVzLm1zZyB8fCAn6amz5Zue5aSx6LSlJykNCiAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygn5bey6amz5ZueJykNCiAgICAgIHRoaXMucmVqZWN0VmlzaWJsZSA9IGZhbHNlDQogICAgICB0aGlzLmZldGNoKCkNCiAgICB9LA0KICAgIGFzeW5jIHJlbW92ZSAoaWQpIHsNCiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGFwaS5jb21wbGFpbnREZWxldGUoaWQpDQogICAgICBpZiAocmVzLmNvZGUgIT09IDApIHJldHVybiB0aGlzLiRtZXNzYWdlLmVycm9yKHJlcy5tc2cgfHwgJ+WIoOmZpOWksei0pScpDQogICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoJ+W3suWIoOmZpCcpDQogICAgICB0aGlzLmZldGNoKCkNCiAgICB9DQogIH0NCn0NCg=="},{"version":3,"sources":["list.vue"],"names":[],"mappings":";AA+JA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"list.vue","sourceRoot":"src/views/modules/message/tousu","sourcesContent":["<template>\r\n  <div>\r\n    <el-card>\r\n      <div style=\"margin-bottom: 12px;\">\r\n        <el-form :inline=\"true\" size=\"small\">\r\n          <el-form-item label=\"投诉编号\">\r\n            <el-input v-model=\"q.complaintNo\" placeholder=\"模糊查询\" clearable />\r\n          </el-form-item>\r\n\r\n          <el-form-item label=\"状态\">\r\n            <el-select v-model=\"q.status\" placeholder=\"全部\" clearable style=\"width: 140px;\">\r\n              <el-option label=\"待处理\" :value=\"0\" />\r\n              <el-option label=\"处理中\" :value=\"1\" />\r\n              <el-option label=\"已结案\" :value=\"2\" />\r\n              <el-option label=\"已驳回\" :value=\"3\" />\r\n            </el-select>\r\n          </el-form-item>\r\n\r\n          <el-form-item label=\"类型\">\r\n            <el-select v-model=\"q.category\" placeholder=\"全部\" clearable style=\"width: 160px;\">\r\n              <el-option label=\"乱吃乱喝\" :value=\"1\" />\r\n              <el-option label=\"大声喧哗\" :value=\"2\" />\r\n              <el-option label=\"随地大小便\" :value=\"3\" />\r\n              <el-option label=\"其他\" :value=\"4\" />\r\n            </el-select>\r\n          </el-form-item>\r\n\r\n          <el-form-item>\r\n            <el-button type=\"primary\" @click=\"fetch()\">查询</el-button>\r\n            <el-button @click=\"reset()\">重置</el-button>\r\n          </el-form-item>\r\n        </el-form>\r\n      </div>\r\n\r\n      <el-table :data=\"list\" border size=\"small\" v-loading=\"loading\">\r\n        <el-table-column prop=\"complaintNo\" label=\"投诉编号\" width=\"140\" />\r\n        <el-table-column prop=\"userId\" label=\"投诉人学号\" width=\"120\" />\r\n        <el-table-column prop=\"roomId\" label=\"自习室\" width=\"90\" />\r\n        <el-table-column prop=\"seatId\" label=\"座位号\" width=\"90\" />\r\n\r\n        <el-table-column prop=\"category\" label=\"类型\" width=\"110\">\r\n          <template slot-scope=\"scope\">\r\n            <el-tag size=\"mini\">{{ categoryText(scope.row.category) }}</el-tag>\r\n          </template>\r\n        </el-table-column>\r\n\r\n        <el-table-column prop=\"detail\" label=\"投诉详情\" min-width=\"220\" show-overflow-tooltip />\r\n\r\n        <el-table-column prop=\"status\" label=\"状态\" width=\"100\">\r\n          <template slot-scope=\"scope\">\r\n            <el-tag size=\"mini\" :type=\"statusTagType(scope.row.status)\">\r\n              {{ statusText(scope.row.status) }}\r\n            </el-tag>\r\n          </template>\r\n        </el-table-column>\r\n\r\n        <el-table-column prop=\"createdAt\" label=\"创建时间\" width=\"170\" />\r\n        <el-table-column prop=\"handledAt\" label=\"处理时间\" width=\"170\" />\r\n\r\n        <el-table-column label=\"操作\" width=\"240\" fixed=\"right\">\r\n          <template slot-scope=\"scope\">\r\n            <el-button type=\"text\" size=\"mini\" @click=\"openDetail(scope.row.id)\">详情</el-button>\r\n\r\n            <el-button\r\n              type=\"text\"\r\n              size=\"mini\"\r\n              @click=\"openApprove(scope.row.id)\"\r\n              :disabled=\"scope.row.status === 2 || scope.row.status === 3\"\r\n            >通过</el-button>\r\n\r\n            <el-button\r\n              type=\"text\"\r\n              size=\"mini\"\r\n              @click=\"openReject(scope.row.id)\"\r\n              :disabled=\"scope.row.status === 2 || scope.row.status === 3\"\r\n            >驳回</el-button>\r\n\r\n            <el-popconfirm title=\"确定删除？\" @confirm=\"remove(scope.row.id)\">\r\n              <el-button slot=\"reference\" type=\"text\" size=\"mini\" style=\"color:#f56c6c;\">删除</el-button>\r\n            </el-popconfirm>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n\r\n      <div style=\"margin-top: 12px; text-align: right;\">\r\n        <el-pagination\r\n          background\r\n          layout=\"total, prev, pager, next, sizes\"\r\n          :total=\"total\"\r\n          :page-size=\"page.limit\"\r\n          :current-page=\"page.page\"\r\n          :page-sizes=\"[10, 20, 50]\"\r\n          @size-change=\"onSizeChange\"\r\n          @current-change=\"onPageChange\"\r\n        />\r\n      </div>\r\n    </el-card>\r\n\r\n    <!-- 详情 -->\r\n    <el-dialog title=\"投诉详情\" :visible.sync=\"detailVisible\" width=\"720px\">\r\n      <div v-if=\"detail\">\r\n        <el-descriptions :column=\"2\" border size=\"small\">\r\n          <el-descriptions-item label=\"投诉编号\">{{ detail.complaintNo }}</el-descriptions-item>\r\n          <el-descriptions-item label=\"投诉人学号\">{{ detail.userId }}</el-descriptions-item>\r\n          <el-descriptions-item label=\"自习室\">{{ detail.roomId }}</el-descriptions-item>\r\n          <el-descriptions-item label=\"座位号\">{{ detail.seatId }}</el-descriptions-item>\r\n          <el-descriptions-item label=\"类型\">{{ categoryText(detail.category) }}</el-descriptions-item>\r\n          <el-descriptions-item label=\"状态\">{{ statusText(detail.status) }}</el-descriptions-item>\r\n          <el-descriptions-item label=\"详情\" :span=\"2\">{{ detail.detail }}</el-descriptions-item>\r\n          <el-descriptions-item label=\"处理摘要\" :span=\"2\">{{ detail.handleSummary || '-' }}</el-descriptions-item>\r\n          <el-descriptions-item label=\"驳回原因\" :span=\"2\">{{ detail.rejectReason || '-' }}</el-descriptions-item>\r\n        </el-descriptions>\r\n\r\n        <div style=\"margin-top: 14px;\">\r\n          <div style=\"font-weight: 600; margin-bottom: 8px;\">证据图片</div>\r\n          <div v-if=\"evidenceUrls.length === 0\">无</div>\r\n          <el-image\r\n            v-for=\"(u, i) in evidenceUrls\"\r\n            :key=\"i\"\r\n            :src=\"u\"\r\n            style=\"width: 120px; height: 120px; margin-right: 10px;\"\r\n            :preview-src-list=\"evidenceUrls\"\r\n          />\r\n        </div>\r\n      </div>\r\n      <span slot=\"footer\">\r\n        <el-button @click=\"detailVisible=false\">关闭</el-button>\r\n      </span>\r\n    </el-dialog>\r\n\r\n    <!-- 通过 -->\r\n    <el-dialog title=\"通过并结案\" :visible.sync=\"approveVisible\" width=\"520px\">\r\n      <el-form label-width=\"90px\" size=\"small\">\r\n        <el-form-item label=\"处理摘要\">\r\n          <el-input type=\"textarea\" v-model=\"approveForm.handleSummary\" :rows=\"4\" placeholder=\"填写处理说明（可选）\" />\r\n        </el-form-item>\r\n      </el-form>\r\n      <span slot=\"footer\">\r\n        <el-button @click=\"approveVisible=false\">取消</el-button>\r\n        <el-button type=\"primary\" @click=\"doApprove()\">确定通过</el-button>\r\n      </span>\r\n    </el-dialog>\r\n\r\n    <!-- 驳回 -->\r\n    <el-dialog title=\"驳回投诉\" :visible.sync=\"rejectVisible\" width=\"520px\">\r\n      <el-form label-width=\"90px\" size=\"small\">\r\n        <el-form-item label=\"驳回原因\" required>\r\n          <el-input type=\"textarea\" v-model=\"rejectForm.rejectReason\" :rows=\"4\" placeholder=\"必填：为什么驳回\" />\r\n        </el-form-item>\r\n      </el-form>\r\n      <span slot=\"footer\">\r\n        <el-button @click=\"rejectVisible=false\">取消</el-button>\r\n        <el-button type=\"danger\" @click=\"doReject()\">确定驳回</el-button>\r\n      </span>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport api from '@/utils/api'\r\n\r\nexport default {\r\n  name: 'Complaint',\r\n  data () {\r\n    return {\r\n      loading: false,\r\n      list: [],\r\n      total: 0,\r\n      page: { page: 1, limit: 10 },\r\n      q: { complaintNo: '', status: null, category: null },\r\n\r\n      detailVisible: false,\r\n      detail: null,\r\n      evidenceUrls: [],\r\n\r\n      approveVisible: false,\r\n      approveForm: { id: null, handleSummary: '' },\r\n\r\n      rejectVisible: false,\r\n      rejectForm: { id: null, rejectReason: '' },\r\n\r\n      handlerAdminId: this.getAdminId()\r\n    }\r\n  },\r\n  mounted () {\r\n    this.fetch()\r\n  },\r\n  methods: {\r\n    // 你按实际登录存储字段改一下\r\n    getAdminId () {\r\n      try {\r\n        const u = JSON.parse(localStorage.getItem('user') || '{}')\r\n        return u.id || u.userId || 1\r\n      } catch (e) {\r\n        return 1\r\n      }\r\n    },\r\n    categoryText (v) {\r\n      const m = { 1: '乱吃乱喝', 2: '大声喧哗', 3: '随地大小便', 4: '其他' }\r\n      return m[v] || '未知'\r\n    },\r\n    statusText (v) {\r\n      const m = { 0: '待处理', 1: '处理中', 2: '已结案', 3: '已驳回' }\r\n      return m[v] || '未知'\r\n    },\r\n    statusTagType (v) {\r\n      if (v === 1) return 'warning'\r\n      if (v === 2) return 'success'\r\n      if (v === 3) return 'danger'\r\n      return ''\r\n    },\r\n    reset () {\r\n      this.q = { complaintNo: '', status: null, category: null }\r\n      this.page.page = 1\r\n      this.fetch()\r\n    },\r\n    onSizeChange (s) {\r\n      this.page.limit = s\r\n      this.page.page = 1\r\n      this.fetch()\r\n    },\r\n    onPageChange (p) {\r\n      this.page.page = p\r\n      this.fetch()\r\n    },\r\n    async fetch () {\r\n      this.loading = true\r\n      try {\r\n        const params = {\r\n          page: this.page.page,\r\n          limit: this.page.limit,\r\n          complaintNo: this.q.complaintNo,\r\n          status: this.q.status,\r\n          category: this.q.category\r\n        }\r\n        const res = await api.complaintPage(params)\r\n        if (res.code !== 0) return this.$message.error(res.msg || '加载失败')\r\n        this.list = (res.data && res.data.list) || []\r\n        this.total = (res.data && res.data.total) || 0\r\n      } finally {\r\n        this.loading = false\r\n      }\r\n    },\r\n    async openDetail (id) {\r\n      const res = await api.complaintInfo(id)\r\n      if (res.code !== 0) return this.$message.error(res.msg || '获取详情失败')\r\n      this.detail = res.data.complaint\r\n      this.evidenceUrls = res.data.evidenceUrls || []\r\n      this.detailVisible = true\r\n    },\r\n    openApprove (id) {\r\n      this.approveForm = { id, handleSummary: '' }\r\n      this.approveVisible = true\r\n    },\r\n    async doApprove () {\r\n      const res = await api.complaintApprove({\r\n        id: this.approveForm.id,\r\n        handlerAdminId: this.handlerAdminId,\r\n        handleSummary: this.approveForm.handleSummary\r\n      })\r\n      if (res.code !== 0) return this.$message.error(res.msg || '处理失败')\r\n      this.$message.success('已通过并结案')\r\n      this.approveVisible = false\r\n      this.fetch()\r\n    },\r\n    openReject (id) {\r\n      this.rejectForm = { id, rejectReason: '' }\r\n      this.rejectVisible = true\r\n    },\r\n    async doReject () {\r\n      if (!this.rejectForm.rejectReason) return this.$message.warning('请填写驳回原因')\r\n      const res = await api.complaintReject({\r\n        id: this.rejectForm.id,\r\n        handlerAdminId: this.handlerAdminId,\r\n        rejectReason: this.rejectForm.rejectReason\r\n      })\r\n      if (res.code !== 0) return this.$message.error(res.msg || '驳回失败')\r\n      this.$message.success('已驳回')\r\n      this.rejectVisible = false\r\n      this.fetch()\r\n    },\r\n    async remove (id) {\r\n      const res = await api.complaintDelete(id)\r\n      if (res.code !== 0) return this.$message.error(res.msg || '删除失败')\r\n      this.$message.success('已删除')\r\n      this.fetch()\r\n    }\r\n  }\r\n}\r\n</script>\r\n"]}]}