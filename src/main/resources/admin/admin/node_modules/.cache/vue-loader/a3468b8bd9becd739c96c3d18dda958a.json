{"remainingRequest":"D:\\3\\软件工程\\项目\\study_room\\src\\main\\resources\\admin\\admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\3\\软件工程\\项目\\study_room\\src\\main\\resources\\admin\\admin\\src\\views\\modules\\ranking\\add-or-update.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\3\\软件工程\\项目\\study_room\\src\\main\\resources\\admin\\admin\\src\\views\\modules\\ranking\\add-or-update.vue","mtime":1766135716000},{"path":"D:\\3\\软件工程\\项目\\study_room\\src\\main\\resources\\admin\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\3\\软件工程\\项目\\study_room\\src\\main\\resources\\admin\\admin\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"D:\\3\\软件工程\\项目\\study_room\\src\\main\\resources\\admin\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\3\\软件工程\\项目\\study_room\\src\\main\\resources\\admin\\admin\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQpleHBvcnQgZGVmYXVsdCB7DQogIG5hbWU6ICJBZGRPclVwZGF0ZSIsDQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIG9wZW46IGZhbHNlLA0KICAgICAgdGl0bGU6ICIiLA0KICAgICAgaXNFZGl0OiBmYWxzZSwNCiAgICAgIG9sZFN0dWRlbnRJZDogIiIsIC8vIOaBouWkjeWOn+Wni29sZFN0dWRlbnRJZOWtl+autQ0KICAgICAgZm9ybTogew0KICAgICAgICBuYW1lOiAiIiwNCiAgICAgICAgc3R1ZGVudElkOiAiIiwNCiAgICAgICAgc3R1ZHlEdXJhdGlvbk1pbjogIiIsDQogICAgICAgIHBob25lOiAiIiwNCiAgICAgICAgY2xhc3NOYW1lOiAiIg0KICAgICAgfSwNCiAgICAgIHJ1bGVzOiB7DQogICAgICAgIG5hbWU6IFt7IHJlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiAi6K+36L6T5YWl5a2m55Sf5aeT5ZCNIiwgdHJpZ2dlcjogImJsdXIiIH1dLA0KICAgICAgICBzdHVkZW50SWQ6IFsNCiAgICAgICAgICB7IHJlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiAi6K+36L6T5YWl5a2m5Y+3IiwgdHJpZ2dlcjogImJsdXIiIH0sDQogICAgICAgICAgeyBwYXR0ZXJuOiAvXlswLTldezl9JC8sIG1lc3NhZ2U6ICLlrablj7flv4XpobvmmK855L2N5pWw5a2XIiwgdHJpZ2dlcjogImJsdXIiIH0NCiAgICAgICAgXSwNCiAgICAgICAgc3R1ZHlEdXJhdGlvbk1pbjogWw0KICAgICAgICAgIHsgcmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICLor7fovpPlhaXoh6rkuaDml7bplb8iLCB0cmlnZ2VyOiAiYmx1ciIgfSwNCiAgICAgICAgICB7IHR5cGU6ICJudW1iZXIiLCBtaW46IDEsIG1lc3NhZ2U6ICLml7bplb/lv4XpobvlpKfkuo4w5LiU5Li65pWw5a2XIiwgdHJpZ2dlcjogImJsdXIiIH0NCiAgICAgICAgXSwNCiAgICAgICAgcGhvbmU6IFsNCiAgICAgICAgICB7IHJlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiAi6K+36L6T5YWl5omL5py65Y+3IiwgdHJpZ2dlcjogImJsdXIiIH0sDQogICAgICAgICAgeyBwYXR0ZXJuOiAvXlswLTldezExfSQvLCBtZXNzYWdlOiAi5omL5py65Y+35b+F6aG75pivMTHkvY3mlbDlrZciLCB0cmlnZ2VyOiAiYmx1ciIgfQ0KICAgICAgICBdLA0KICAgICAgICBjbGFzc05hbWU6IFt7IHJlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiAi6K+36L6T5YWl54+t57qnIiwgdHJpZ2dlcjogImJsdXIiIH1dDQogICAgICB9DQogICAgfTsNCiAgfSwNCiAgbWV0aG9kczogew0KICAgIC8vIOaBouWkjeWOn+Wni2luaXTpgLvovpHvvIjkvKBzdHVkZW50SWTvvIkNCiAgICBpbml0KHN0dWRlbnRJZCkgew0KICAgICAgdGhpcy5vcGVuID0gdHJ1ZTsNCiAgICAgIHRoaXMub2xkU3R1ZGVudElkID0gc3R1ZGVudElkIHx8ICIiOw0KICAgICAgdGhpcy5pc0VkaXQgPSAhIXN0dWRlbnRJZDsNCiAgICAgIHRoaXMudGl0bGUgPSB0aGlzLmlzRWRpdCA/ICLkv67mlLnoh6rkuaDml7bplb8iIDogIuaWsOWinuiHquS5oOaXtumVvyI7DQoNCiAgICAgIC8vIOWIneWni+WMluihqOWNlQ0KICAgICAgdGhpcy5mb3JtID0gew0KICAgICAgICBuYW1lOiAiIiwNCiAgICAgICAgc3R1ZGVudElkOiAiIiwNCiAgICAgICAgc3R1ZHlEdXJhdGlvbk1pbjogIiIsDQogICAgICAgIHBob25lOiAiIiwNCiAgICAgICAgY2xhc3NOYW1lOiAiIg0KICAgICAgfTsNCg0KICAgICAgaWYgKHN0dWRlbnRJZCkgew0KICAgICAgICAvLyDmn6Xor6Lor6bmg4XmjqXlj6PvvIjmgaLlpI3ljp/lp4vpgLvovpHvvIkNCiAgICAgICAgdGhpcy4kaHR0cC5nZXQoYC9yYW5raW5nL2luZm8vJHtzdHVkZW50SWR9YCkudGhlbigoeyBkYXRhIH0pID0+IHsNCiAgICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLmNvZGUgPT09IDAgJiYgZGF0YS5kYXRhKSB7DQogICAgICAgICAgICBjb25zdCByZXMgPSBkYXRhLmRhdGE7DQogICAgICAgICAgICB0aGlzLmZvcm0gPSB7DQogICAgICAgICAgICAgIG5hbWU6IHJlcy5uYW1lIHx8ICIiLA0KICAgICAgICAgICAgICBzdHVkZW50SWQ6IHJlcy5zdHVkZW50X2lkIHx8IHJlcy5zdHVkZW50SWQgfHwgIiIsDQogICAgICAgICAgICAgIHN0dWR5RHVyYXRpb25NaW46IHJlcy5zdHVkeV9kdXJhdGlvbl9taW4gfHwgcmVzLnN0dWR5RHVyYXRpb25NaW4gfHwgIiIsDQogICAgICAgICAgICAgIHBob25lOiByZXMucGhvbmUgfHwgIiIsDQogICAgICAgICAgICAgIGNsYXNzTmFtZTogcmVzLmNsYXNzTmFtZSB8fCAiIg0KICAgICAgICAgICAgfTsNCiAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgfQ0KICAgIH0sDQoNCiAgICBzdWJtaXRGb3JtKCkgew0KICAgICAgdGhpcy4kcmVmcy5mb3JtLnZhbGlkYXRlKCh2YWxpZCkgPT4gew0KICAgICAgICBpZiAoIXZhbGlkKSB7DQogICAgICAgICAgdGhpcy4kbWVzc2FnZS53YXJuaW5nKCLor7flrozlloTooajljZXkv6Hmga/lubbnoa7kv53moLzlvI/mraPnoa4iKTsNCiAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICAvLyDmgaLlpI3ljp/lp4vmj5DkuqTmlbDmja7moLzlvI8NCiAgICAgICAgY29uc3Qgc3VibWl0RGF0YSA9IHsNCiAgICAgICAgICBvbGRTdHVkZW50SWQ6IHRoaXMub2xkU3R1ZGVudElkLA0KICAgICAgICAgIG5hbWU6IHRoaXMuZm9ybS5uYW1lLA0KICAgICAgICAgIHN0dWRlbnRfaWQ6IHRoaXMuZm9ybS5zdHVkZW50SWQsDQogICAgICAgICAgc3R1ZHlfZHVyYXRpb25fbWluOiBOdW1iZXIodGhpcy5mb3JtLnN0dWR5RHVyYXRpb25NaW4pLA0KICAgICAgICAgIHBob25lOiB0aGlzLmZvcm0ucGhvbmUsDQogICAgICAgICAgY2xhc3NOYW1lOiB0aGlzLmZvcm0uY2xhc3NOYW1lDQogICAgICAgIH07DQoNCiAgICAgICAgY29uc3QgbG9hZGluZyA9IHRoaXMuJGxvYWRpbmcoeyB0ZXh0OiAi5o+Q5Lqk5LitLi4uIiB9KTsNCiAgICAgICAgdGhpcy4kaHR0cCh7DQogICAgICAgICAgdXJsOiB0aGlzLmlzRWRpdCA/ICIvcmFua2luZy91cGRhdGUiIDogIi9yYW5raW5nL3NhdmUiLA0KICAgICAgICAgIG1ldGhvZDogInBvc3QiLA0KICAgICAgICAgIGRhdGE6IHN1Ym1pdERhdGENCiAgICAgICAgfSkudGhlbigoeyBkYXRhIH0pID0+IHsNCiAgICAgICAgICBsb2FkaW5nLmNsb3NlKCk7DQogICAgICAgICAgaWYgKGRhdGEgJiYgZGF0YS5jb2RlID09PSAwKSB7DQogICAgICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoZGF0YS5tc2cgfHwgIuaTjeS9nOaIkOWKnyIpOw0KICAgICAgICAgICAgdGhpcy5vcGVuID0gZmFsc2U7DQogICAgICAgICAgICB0aGlzLiRwYXJlbnQuZ2V0RGF0YUxpc3QoKTsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihkYXRhPy5tc2cgfHwgIuaTjeS9nOWksei0pSIpOw0KICAgICAgICAgIH0NCiAgICAgICAgfSkuY2F0Y2goKCkgPT4gew0KICAgICAgICAgIGxvYWRpbmcuY2xvc2UoKTsNCiAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCLmj5DkuqTlpLHotKXvvIzml6Dms5Xov57mjqXmlbDmja7lupMiKTsNCiAgICAgICAgfSk7DQogICAgICB9KTsNCiAgICB9LA0KDQogICAgY2FuY2VsKCkgew0KICAgICAgdGhpcy5vcGVuID0gZmFsc2U7DQogICAgICBpZiAodGhpcy4kcmVmcy5mb3JtKSB0aGlzLiRyZWZzLmZvcm0ucmVzZXRGaWVsZHMoKTsNCiAgICB9DQogIH0NCn07DQo="},{"version":3,"sources":["add-or-update.vue"],"names":[],"mappings":";AAuCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA","file":"add-or-update.vue","sourceRoot":"src/views/modules/ranking","sourcesContent":["<template>\r\n  <el-dialog\r\n    :title=\"title\"\r\n    :visible.sync=\"open\"\r\n    width=\"500px\"\r\n    :close-on-click-modal=\"false\"\r\n  >\r\n    <!-- 还原修改弹窗样式 -->\r\n    <el-form\r\n      ref=\"form\"\r\n      :model=\"form\"\r\n      :rules=\"rules\"\r\n      label-width=\"100px\"\r\n      validate-on-rule-change=\"false\"\r\n    >\r\n      <el-form-item label=\"学生姓名\" prop=\"name\">\r\n        <el-input v-model=\"form.name\" placeholder=\"请输入学生姓名\" />\r\n      </el-form-item>\r\n      <el-form-item label=\"学号\" prop=\"studentId\">\r\n        <el-input v-model=\"form.studentId\" placeholder=\"请输入9位学号\" />\r\n      </el-form-item>\r\n      <el-form-item label=\"自习时长\" prop=\"studyDurationMin\">\r\n        <el-input v-model.number=\"form.studyDurationMin\" placeholder=\"请输入总分钟数\" type=\"number\" />\r\n      </el-form-item>\r\n      <el-form-item label=\"手机号\" prop=\"phone\">\r\n        <el-input v-model=\"form.phone\" placeholder=\"请输入11位手机号\" />\r\n      </el-form-item>\r\n      <el-form-item label=\"班级\" prop=\"className\">\r\n        <el-input v-model=\"form.className\" placeholder=\"请输入班级\" />\r\n      </el-form-item>\r\n    </el-form>\r\n    <template slot=\"footer\">\r\n      <el-button type=\"primary\" @click=\"submitForm\" plain>确 定</el-button>\r\n      <el-button @click=\"cancel\" plain>取 消</el-button>\r\n    </template>\r\n  </el-dialog>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"AddOrUpdate\",\r\n  data() {\r\n    return {\r\n      open: false,\r\n      title: \"\",\r\n      isEdit: false,\r\n      oldStudentId: \"\", // 恢复原始oldStudentId字段\r\n      form: {\r\n        name: \"\",\r\n        studentId: \"\",\r\n        studyDurationMin: \"\",\r\n        phone: \"\",\r\n        className: \"\"\r\n      },\r\n      rules: {\r\n        name: [{ required: true, message: \"请输入学生姓名\", trigger: \"blur\" }],\r\n        studentId: [\r\n          { required: true, message: \"请输入学号\", trigger: \"blur\" },\r\n          { pattern: /^[0-9]{9}$/, message: \"学号必须是9位数字\", trigger: \"blur\" }\r\n        ],\r\n        studyDurationMin: [\r\n          { required: true, message: \"请输入自习时长\", trigger: \"blur\" },\r\n          { type: \"number\", min: 1, message: \"时长必须大于0且为数字\", trigger: \"blur\" }\r\n        ],\r\n        phone: [\r\n          { required: true, message: \"请输入手机号\", trigger: \"blur\" },\r\n          { pattern: /^[0-9]{11}$/, message: \"手机号必须是11位数字\", trigger: \"blur\" }\r\n        ],\r\n        className: [{ required: true, message: \"请输入班级\", trigger: \"blur\" }]\r\n      }\r\n    };\r\n  },\r\n  methods: {\r\n    // 恢复原始init逻辑（传studentId）\r\n    init(studentId) {\r\n      this.open = true;\r\n      this.oldStudentId = studentId || \"\";\r\n      this.isEdit = !!studentId;\r\n      this.title = this.isEdit ? \"修改自习时长\" : \"新增自习时长\";\r\n\r\n      // 初始化表单\r\n      this.form = {\r\n        name: \"\",\r\n        studentId: \"\",\r\n        studyDurationMin: \"\",\r\n        phone: \"\",\r\n        className: \"\"\r\n      };\r\n\r\n      if (studentId) {\r\n        // 查询详情接口（恢复原始逻辑）\r\n        this.$http.get(`/ranking/info/${studentId}`).then(({ data }) => {\r\n          if (data && data.code === 0 && data.data) {\r\n            const res = data.data;\r\n            this.form = {\r\n              name: res.name || \"\",\r\n              studentId: res.student_id || res.studentId || \"\",\r\n              studyDurationMin: res.study_duration_min || res.studyDurationMin || \"\",\r\n              phone: res.phone || \"\",\r\n              className: res.className || \"\"\r\n            };\r\n          }\r\n        });\r\n      }\r\n    },\r\n\r\n    submitForm() {\r\n      this.$refs.form.validate((valid) => {\r\n        if (!valid) {\r\n          this.$message.warning(\"请完善表单信息并确保格式正确\");\r\n          return;\r\n        }\r\n\r\n        // 恢复原始提交数据格式\r\n        const submitData = {\r\n          oldStudentId: this.oldStudentId,\r\n          name: this.form.name,\r\n          student_id: this.form.studentId,\r\n          study_duration_min: Number(this.form.studyDurationMin),\r\n          phone: this.form.phone,\r\n          className: this.form.className\r\n        };\r\n\r\n        const loading = this.$loading({ text: \"提交中...\" });\r\n        this.$http({\r\n          url: this.isEdit ? \"/ranking/update\" : \"/ranking/save\",\r\n          method: \"post\",\r\n          data: submitData\r\n        }).then(({ data }) => {\r\n          loading.close();\r\n          if (data && data.code === 0) {\r\n            this.$message.success(data.msg || \"操作成功\");\r\n            this.open = false;\r\n            this.$parent.getDataList();\r\n          } else {\r\n            this.$message.error(data?.msg || \"操作失败\");\r\n          }\r\n        }).catch(() => {\r\n          loading.close();\r\n          this.$message.error(\"提交失败，无法连接数据库\");\r\n        });\r\n      });\r\n    },\r\n\r\n    cancel() {\r\n      this.open = false;\r\n      if (this.$refs.form) this.$refs.form.resetFields();\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.el-dialog__footer { text-align: center; }\r\n.el-button { min-width: 80px; margin: 0 5px; cursor: pointer; }\r\n</style>"]}]}