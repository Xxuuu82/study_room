{"remainingRequest":"D:\\3\\软件工程\\项目\\study_room1\\study_room1\\study_room4\\study_room\\src\\main\\resources\\admin\\admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\3\\软件工程\\项目\\study_room1\\study_room1\\study_room4\\study_room\\src\\main\\resources\\admin\\admin\\src\\views\\modules\\ranking\\add-or-update.vue?vue&type=style&index=0&id=3afef708&scoped=true&lang=css","dependencies":[{"path":"D:\\3\\软件工程\\项目\\study_room1\\study_room1\\study_room4\\study_room\\src\\main\\resources\\admin\\admin\\src\\views\\modules\\ranking\\add-or-update.vue","mtime":1766135716000},{"path":"D:\\3\\软件工程\\项目\\study_room1\\study_room1\\study_room4\\study_room\\src\\main\\resources\\admin\\admin\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\3\\软件工程\\项目\\study_room1\\study_room1\\study_room4\\study_room\\src\\main\\resources\\admin\\admin\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\3\\软件工程\\项目\\study_room1\\study_room1\\study_room4\\study_room\\src\\main\\resources\\admin\\admin\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\3\\软件工程\\项目\\study_room1\\study_room1\\study_room4\\study_room\\src\\main\\resources\\admin\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\3\\软件工程\\项目\\study_room1\\study_room1\\study_room4\\study_room\\src\\main\\resources\\admin\\admin\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQouZWwtZGlhbG9nX19mb290ZXIgeyB0ZXh0LWFsaWduOiBjZW50ZXI7IH0NCi5lbC1idXR0b24geyBtaW4td2lkdGg6IDgwcHg7IG1hcmdpbjogMCA1cHg7IGN1cnNvcjogcG9pbnRlcjsgfQ0K"},{"version":3,"sources":["add-or-update.vue"],"names":[],"mappings":";AAyJA;AACA","file":"add-or-update.vue","sourceRoot":"src/views/modules/ranking","sourcesContent":["<template>\r\n  <el-dialog\r\n    :title=\"title\"\r\n    :visible.sync=\"open\"\r\n    width=\"500px\"\r\n    :close-on-click-modal=\"false\"\r\n  >\r\n    <!-- 还原修改弹窗样式 -->\r\n    <el-form\r\n      ref=\"form\"\r\n      :model=\"form\"\r\n      :rules=\"rules\"\r\n      label-width=\"100px\"\r\n      validate-on-rule-change=\"false\"\r\n    >\r\n      <el-form-item label=\"学生姓名\" prop=\"name\">\r\n        <el-input v-model=\"form.name\" placeholder=\"请输入学生姓名\" />\r\n      </el-form-item>\r\n      <el-form-item label=\"学号\" prop=\"studentId\">\r\n        <el-input v-model=\"form.studentId\" placeholder=\"请输入9位学号\" />\r\n      </el-form-item>\r\n      <el-form-item label=\"自习时长\" prop=\"studyDurationMin\">\r\n        <el-input v-model.number=\"form.studyDurationMin\" placeholder=\"请输入总分钟数\" type=\"number\" />\r\n      </el-form-item>\r\n      <el-form-item label=\"手机号\" prop=\"phone\">\r\n        <el-input v-model=\"form.phone\" placeholder=\"请输入11位手机号\" />\r\n      </el-form-item>\r\n      <el-form-item label=\"班级\" prop=\"className\">\r\n        <el-input v-model=\"form.className\" placeholder=\"请输入班级\" />\r\n      </el-form-item>\r\n    </el-form>\r\n    <template slot=\"footer\">\r\n      <el-button type=\"primary\" @click=\"submitForm\" plain>确 定</el-button>\r\n      <el-button @click=\"cancel\" plain>取 消</el-button>\r\n    </template>\r\n  </el-dialog>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"AddOrUpdate\",\r\n  data() {\r\n    return {\r\n      open: false,\r\n      title: \"\",\r\n      isEdit: false,\r\n      oldStudentId: \"\", // 恢复原始oldStudentId字段\r\n      form: {\r\n        name: \"\",\r\n        studentId: \"\",\r\n        studyDurationMin: \"\",\r\n        phone: \"\",\r\n        className: \"\"\r\n      },\r\n      rules: {\r\n        name: [{ required: true, message: \"请输入学生姓名\", trigger: \"blur\" }],\r\n        studentId: [\r\n          { required: true, message: \"请输入学号\", trigger: \"blur\" },\r\n          { pattern: /^[0-9]{9}$/, message: \"学号必须是9位数字\", trigger: \"blur\" }\r\n        ],\r\n        studyDurationMin: [\r\n          { required: true, message: \"请输入自习时长\", trigger: \"blur\" },\r\n          { type: \"number\", min: 1, message: \"时长必须大于0且为数字\", trigger: \"blur\" }\r\n        ],\r\n        phone: [\r\n          { required: true, message: \"请输入手机号\", trigger: \"blur\" },\r\n          { pattern: /^[0-9]{11}$/, message: \"手机号必须是11位数字\", trigger: \"blur\" }\r\n        ],\r\n        className: [{ required: true, message: \"请输入班级\", trigger: \"blur\" }]\r\n      }\r\n    };\r\n  },\r\n  methods: {\r\n    // 恢复原始init逻辑（传studentId）\r\n    init(studentId) {\r\n      this.open = true;\r\n      this.oldStudentId = studentId || \"\";\r\n      this.isEdit = !!studentId;\r\n      this.title = this.isEdit ? \"修改自习时长\" : \"新增自习时长\";\r\n\r\n      // 初始化表单\r\n      this.form = {\r\n        name: \"\",\r\n        studentId: \"\",\r\n        studyDurationMin: \"\",\r\n        phone: \"\",\r\n        className: \"\"\r\n      };\r\n\r\n      if (studentId) {\r\n        // 查询详情接口（恢复原始逻辑）\r\n        this.$http.get(`/ranking/info/${studentId}`).then(({ data }) => {\r\n          if (data && data.code === 0 && data.data) {\r\n            const res = data.data;\r\n            this.form = {\r\n              name: res.name || \"\",\r\n              studentId: res.student_id || res.studentId || \"\",\r\n              studyDurationMin: res.study_duration_min || res.studyDurationMin || \"\",\r\n              phone: res.phone || \"\",\r\n              className: res.className || \"\"\r\n            };\r\n          }\r\n        });\r\n      }\r\n    },\r\n\r\n    submitForm() {\r\n      this.$refs.form.validate((valid) => {\r\n        if (!valid) {\r\n          this.$message.warning(\"请完善表单信息并确保格式正确\");\r\n          return;\r\n        }\r\n\r\n        // 恢复原始提交数据格式\r\n        const submitData = {\r\n          oldStudentId: this.oldStudentId,\r\n          name: this.form.name,\r\n          student_id: this.form.studentId,\r\n          study_duration_min: Number(this.form.studyDurationMin),\r\n          phone: this.form.phone,\r\n          className: this.form.className\r\n        };\r\n\r\n        const loading = this.$loading({ text: \"提交中...\" });\r\n        this.$http({\r\n          url: this.isEdit ? \"/ranking/update\" : \"/ranking/save\",\r\n          method: \"post\",\r\n          data: submitData\r\n        }).then(({ data }) => {\r\n          loading.close();\r\n          if (data && data.code === 0) {\r\n            this.$message.success(data.msg || \"操作成功\");\r\n            this.open = false;\r\n            this.$parent.getDataList();\r\n          } else {\r\n            this.$message.error(data?.msg || \"操作失败\");\r\n          }\r\n        }).catch(() => {\r\n          loading.close();\r\n          this.$message.error(\"提交失败，无法连接数据库\");\r\n        });\r\n      });\r\n    },\r\n\r\n    cancel() {\r\n      this.open = false;\r\n      if (this.$refs.form) this.$refs.form.resetFields();\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.el-dialog__footer { text-align: center; }\r\n.el-button { min-width: 80px; margin: 0 5px; cursor: pointer; }\r\n</style>"]}]}