{"remainingRequest":"D:\\3\\软件工程\\项目\\study_room1\\study_room1\\study_room4\\study_room\\src\\main\\resources\\admin\\admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\3\\软件工程\\项目\\study_room1\\study_room1\\study_room4\\study_room\\src\\main\\resources\\admin\\admin\\src\\views\\blacklist.vue?vue&type=style&index=0&id=54802c1a&lang=scss&scoped=true","dependencies":[{"path":"D:\\3\\软件工程\\项目\\study_room1\\study_room1\\study_room4\\study_room\\src\\main\\resources\\admin\\admin\\src\\views\\blacklist.vue","mtime":1765816574000},{"path":"D:\\3\\软件工程\\项目\\study_room1\\study_room1\\study_room4\\study_room\\src\\main\\resources\\admin\\admin\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\3\\软件工程\\项目\\study_room1\\study_room1\\study_room4\\study_room\\src\\main\\resources\\admin\\admin\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\3\\软件工程\\项目\\study_room1\\study_room1\\study_room4\\study_room\\src\\main\\resources\\admin\\admin\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\3\\软件工程\\项目\\study_room1\\study_room1\\study_room4\\study_room\\src\\main\\resources\\admin\\admin\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\3\\软件工程\\项目\\study_room1\\study_room1\\study_room4\\study_room\\src\\main\\resources\\admin\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\3\\软件工程\\项目\\study_room1\\study_room1\\study_room4\\study_room\\src\\main\\resources\\admin\\admin\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQouYmxhY2tsaXN0LWNvbnRhaW5lciB7DQogIHBhZGRpbmc6IDIwcHg7DQogIGJhY2tncm91bmQtY29sb3I6ICNmNWY3ZmE7DQoNCiAgLmluZm8tY2FyZCB7DQogICAgYm9yZGVyLXJhZGl1czogMTJweDsNCiAgICBvdmVyZmxvdzogaGlkZGVuOw0KDQogICAgLmNhcmQtaGVhZGVyIHsNCiAgICAgIGRpc3BsYXk6IGZsZXg7DQogICAgICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47DQogICAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgICAgcGFkZGluZzogMTZweCAyMHB4Ow0KICAgICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNlZWU7DQogICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmOw0KDQogICAgICBoMiB7DQogICAgICAgIG1hcmdpbjogMDsNCiAgICAgICAgZm9udC1zaXplOiAxOHB4Ow0KICAgICAgICBmb250LXdlaWdodDogNjAwOw0KICAgICAgICBjb2xvcjogIzMzMzsNCiAgICAgIH0NCiAgICB9DQoNCiAgICAuc2VhcmNoLWZvcm0gew0KICAgICAgcGFkZGluZzogMjBweDsNCiAgICAgIGJhY2tncm91bmQtY29sb3I6ICNmZmY7DQogICAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgI2VlZTsNCiAgICB9DQoNCiAgICAudGFibGUtY29udGFpbmVyIHsNCiAgICAgIHBhZGRpbmc6IDIwcHg7DQogICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmOw0KDQogICAgICAuY291bnQtdGV4dCB7DQogICAgICAgIGNvbG9yOiAjZTZhMjNjOw0KICAgICAgICBmb250LXdlaWdodDogNjAwOw0KICAgICAgfQ0KDQogICAgICAuZGV0YWlsLWl0ZW0gew0KICAgICAgICBsaW5lLWhlaWdodDogMS44Ow0KICAgICAgICBmb250LXNpemU6IDEzcHg7DQogICAgICAgIGNvbG9yOiAjNjY2Ow0KICAgICAgfQ0KDQogICAgICAucGxhbi10ZXh0IHsNCiAgICAgICAgY29sb3I6ICM5OTk7DQogICAgICB9DQoNCiAgICAgIC5zdWNjZXNzLXRleHQgew0KICAgICAgICBjb2xvcjogIzY3YzIzYTsNCiAgICAgIH0NCiAgICB9DQogIH0NCn0NCg0KLmVsLWZvcm0taXRlbSB7DQogIG1hcmdpbi1ib3R0b206IDE1cHg7DQoNCiAgLmVsLWZvcm0taXRlbV9fbGFiZWwgew0KICAgIGNvbG9yOiAjNjY2Ow0KICAgIGZvbnQtd2VpZ2h0OiA1MDA7DQogIH0NCg0KICAuZWwtaW5wdXRfX2lubmVyLA0KICAuZWwtc2VsZWN0X193cmFwcGVyIHsNCiAgICBib3JkZXItcmFkaXVzOiA2cHg7DQogICAgYm9yZGVyLWNvbG9yOiAjZGNkZmU2Ow0KICAgIHRyYW5zaXRpb246IGFsbCAwLjNzOw0KDQogICAgJjpmb2N1cyB7DQogICAgICBib3JkZXItY29sb3I6ICM0MDllZmY7DQogICAgICBib3gtc2hhZG93OiAwIDAgMCAycHggcmdiYSg2NCwgMTU4LCAyNTUsIDAuMik7DQogICAgfQ0KICB9DQp9DQoNCi5lbC10YWJsZSB7DQogIC0tZWwtdGFibGUtaGVhZGVyLXRleHQtY29sb3I6ICM2NjY7DQogIC0tZWwtdGFibGUtcm93LWhvdmVyLWJnLWNvbG9yOiAjZjhmOWZhOw0KDQogIC5lbC10YWJsZV9faGVhZGVyLXdyYXBwZXIgew0KICAgIHRoIHsNCiAgICAgIGJhY2tncm91bmQtY29sb3I6ICNmNWY3ZmE7DQogICAgICBmb250LXdlaWdodDogNTAwOw0KICAgIH0NCiAgfQ0KfQ0KDQouZWwtcGFnaW5hdGlvbiB7DQogIC5lbC1wYWdpbmF0aW9uX19zaXplcyB7DQogICAgbWFyZ2luLXJpZ2h0OiAxMHB4Ow0KICB9DQoNCiAgLmVsLXBhZ2VyIGxpIHsNCiAgICBib3JkZXItcmFkaXVzOiA0cHg7DQogICAgbWFyZ2luOiAwIDJweDsNCiAgfQ0KDQogIC5lbC1wYWdlciBsaS5hY3RpdmUgew0KICAgIGJhY2tncm91bmQtY29sb3I6ICM0MDllZmY7DQogICAgY29sb3I6ICNmZmY7DQogIH0NCn0NCg=="},{"version":3,"sources":["blacklist.vue"],"names":[],"mappings":";AAiPA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"blacklist.vue","sourceRoot":"src/views","sourcesContent":["<template>\r\n  <div class=\"blacklist-container\">\r\n    <!-- 黑名单管理卡片 -->\r\n    <el-card class=\"info-card\" shadow=\"hover\">\r\n      <div class=\"card-header\">\r\n        <h2>黑名单管理</h2>\r\n        <el-tag type=\"danger\" size=\"small\">违规累计≥3次自动拉黑</el-tag>\r\n      </div>\r\n\r\n      <!-- 搜索栏 -->\r\n      <div class=\"search-form\">\r\n        <el-form :model=\"searchForm\" inline @submit.prevent=\"handleSearch\">\r\n          <el-form-item label=\"学号\">\r\n            <el-input\r\n              v-model=\"searchForm.xuehao\"\r\n              placeholder=\"请输入学号搜索\"\r\n              clearable\r\n              style=\"width: 200px\"\r\n            />\r\n          </el-form-item>\r\n          <el-form-item label=\"状态\">\r\n            <el-select\r\n              v-model=\"searchForm.shifoujiechu\"\r\n              placeholder=\"请选择状态\"\r\n              clearable\r\n              style=\"width: 150px\"\r\n            >\r\n              <el-option label=\"全部\" value=\"\" />\r\n              <el-option label=\"拉黑中\" value=\"0\" />\r\n              <el-option label=\"已解除\" value=\"1\" />\r\n            </el-select>\r\n          </el-form-item>\r\n          <el-form-item>\r\n            <el-button type=\"primary\" @click=\"handleSearch\">查询</el-button>\r\n          </el-form-item>\r\n        </el-form>\r\n      </div>\r\n\r\n      <!-- 黑名单列表表格 -->\r\n      <div class=\"table-container\">\r\n        <el-table\r\n          :data=\"tableData\"\r\n          border\r\n          stripe\r\n          v-loading=\"loading\"\r\n          style=\"width: 100%\"\r\n          :empty-text=\"loading ? '加载中...' : '暂无黑名单数据'\"\r\n        >\r\n          <!-- 学号（匹配后端xuehao字段） -->\r\n          <el-table-column prop=\"xuehao\" label=\"学号\" width=\"120\" />\r\n          <!-- 姓名（匹配后端xingming字段） -->\r\n          <el-table-column prop=\"xingming\" label=\"姓名\" width=\"120\" />\r\n          <!-- 累计违规次数（匹配后端驼峰字段totalWeiguiCount） -->\r\n          <el-table-column label=\"累计违规次数\" width=\"120\">\r\n            <template slot-scope=\"scope\">\r\n              <span class=\"count-text\">{{ scope.row.totalWeiguiCount || 0 }}次</span>\r\n            </template>\r\n          </el-table-column>\r\n          <!-- 违规明细（匹配后端驼峰字段） -->\r\n          <el-table-column label=\"违规明细\" min-width=\"200\">\r\n            <template slot-scope=\"scope\">\r\n              <div class=\"detail-item\">教室乱吃乱喝：{{ scope.row.weiguiChifanCount || 0 }}次</div>\r\n              <div class=\"detail-item\">未签到：{{ scope.row.weiguiWeiqiandaoCount || 0 }}次</div>\r\n              <div class=\"detail-item\">大声喧哗：{{ scope.row.weiguiXuanhuaCount || 0 }}次</div>\r\n              <div class=\"detail-item\">随地大小便：{{ scope.row.weiguiSuibiaobianCount || 0 }}次</div>\r\n              <div v-if=\"scope.row.otherWeiguiDesc\" class=\"detail-item\">其他违规：{{ scope.row.otherWeiguiDesc }}</div>\r\n            </template>\r\n          </el-table-column>\r\n          <!-- 拉黑原因（匹配后端heimingdanYuanyin字段） -->\r\n          <el-table-column prop=\"heimingdanYuanyin\" label=\"拉黑原因\" min-width=\"200\" />\r\n          <!-- 加入时间（格式化时间戳） -->\r\n          <el-table-column label=\"加入时间\" width=\"200\">\r\n            <template slot-scope=\"scope\">\r\n              {{ formatDate(scope.row.heimingdanStartTime) }}\r\n            </template>\r\n          </el-table-column>\r\n          <!-- 解除时间（格式化时间戳） -->\r\n          <el-table-column label=\"解除时间\" width=\"200\">\r\n            <template slot-scope=\"scope\">\r\n              <span :class=\"scope.row.shifoujiechu === 0 ? 'plan-text' : 'success-text'\">\r\n                {{ formatDate(scope.row.heimingdanEndTime) }}\r\n                <span v-if=\"scope.row.shifoujiechu === 0\">（计划）</span>\r\n              </span>\r\n            </template>\r\n          </el-table-column>\r\n          <!-- 状态 -->\r\n          <el-table-column label=\"状态\" width=\"100\">\r\n            <template slot-scope=\"scope\">\r\n              <el-tag :type=\"scope.row.shifoujiechu === 0 ? 'danger' : 'success'\">\r\n                {{ scope.row.shifoujiechu === 0 ? '拉黑中' : '已解除' }}\r\n              </el-tag>\r\n            </template>\r\n          </el-table-column>\r\n          <!-- 操作 -->\r\n          <el-table-column label=\"操作\" width=\"120\">\r\n            <template slot-scope=\"scope\">\r\n              <el-button\r\n                type=\"success\"\r\n                size=\"small\"\r\n                @click=\"jiechuBlackList(scope.row)\"\r\n                :disabled=\"scope.row.shifoujiechu === 1\"\r\n              >\r\n                解除\r\n              </el-button>\r\n            </template>\r\n          </el-table-column>\r\n        </el-table>\r\n\r\n        <!-- 分页组件 -->\r\n        <el-pagination\r\n          @size-change=\"handleSizeChange\"\r\n          @current-change=\"handleCurrentChange\"\r\n          :current-page=\"pageNum\"\r\n          :page-sizes=\"[10, 20, 50]\"\r\n          :page-size=\"pageSize\"\r\n          layout=\"total, sizes, prev, pager, next, jumper\"\r\n          :total=\"total\"\r\n          style=\"margin-top: 20px; text-align: right\"\r\n        />\r\n      </div>\r\n    </el-card>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport http from '@/utils/http'\r\nimport { Message, MessageBox } from 'element-ui'\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      tableData: [],\r\n      loading: false,\r\n      pageNum: 1,\r\n      pageSize: 10,\r\n      total: 0,\r\n      searchForm: {\r\n        xuehao: \"\",\r\n        shifoujiechu: \"\"\r\n      }\r\n    };\r\n  },\r\n  mounted() {\r\n    this.getBlackList();\r\n  },\r\n  methods: {\r\n    // 日期格式化：适配后端返回的时间戳（毫秒）\r\n    formatDate(timestamp) {\r\n      if (!timestamp) return \"-\";\r\n      try {\r\n        const date = new Date(timestamp);\r\n        const year = date.getFullYear();\r\n        const month = String(date.getMonth() + 1).padStart(2, '0');\r\n        const day = String(date.getDate()).padStart(2, '0');\r\n        const hours = String(date.getHours()).padStart(2, '0');\r\n        const minutes = String(date.getMinutes()).padStart(2, '0');\r\n        const seconds = String(date.getSeconds()).padStart(2, '0');\r\n        return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;\r\n      } catch (e) {\r\n        return \"-\";\r\n      }\r\n    },\r\n\r\n    // 获取黑名单列表（核心修改：适配现有http.js的返回格式）\r\n    async getBlackList() {\r\n      this.loading = true;\r\n      try {\r\n        // 1. 发送请求（路径不变，适配现有http.js的baseURL）\r\n        const response = await http.get(\"/api/heimingdan/list\", {\r\n          params: {\r\n            page: this.pageNum,\r\n            size: this.pageSize,\r\n            xuehao: this.searchForm.xuehao,\r\n            shifoujiechu: this.searchForm.shifoujiechu\r\n          }\r\n        });\r\n        // 2. 核心修改：现有http.js返回的是axios完整响应对象，需先取response.data\r\n        const res = response.data;\r\n        // 3. 解析后端返回的data（res.data才是真正的列表数据）\r\n        this.tableData = res.data?.records || [];\r\n        this.total = res.data?.total || 0;\r\n\r\n        // 调试用：打印数据，方便你确认是否获取到（可选）\r\n        console.log(\"黑名单数据：\", this.tableData);\r\n      } catch (error) {\r\n        console.error(\"获取黑名单失败：\", error);\r\n        Message.error(\"获取黑名单列表失败，请检查后端服务！\");\r\n        this.tableData = [];\r\n        this.total = 0;\r\n      } finally {\r\n        this.loading = false;\r\n      }\r\n    },\r\n\r\n    // 解除黑名单（同样适配现有http.js的返回格式）\r\n    async jiechuBlackList(row) {\r\n      try {\r\n        await MessageBox.confirm(\r\n          `确定要解除【${row.xingming || row.xuehao}】的黑名单吗？`,\r\n          \"提示\",\r\n          { type: \"warning\" }\r\n        );\r\n        const response = await http.post(\"/api/heimingdan/jiechu\", {\r\n          xuehao: row.xuehao\r\n        });\r\n        const res = response.data;\r\n        if (res.code === 0) {\r\n          Message.success(\"解除黑名单成功\");\r\n          this.getBlackList(); // 刷新列表\r\n        } else {\r\n          Message.error(res.msg || \"解除失败\");\r\n        }\r\n      } catch (error) {\r\n        if (error !== \"cancel\") {\r\n          Message.error(\"解除失败，请稍后重试\");\r\n        }\r\n      }\r\n    },\r\n\r\n    // 搜索事件\r\n    handleSearch() {\r\n      this.pageNum = 1;\r\n      this.getBlackList();\r\n    },\r\n\r\n    // 分页-切换每页条数\r\n    handleSizeChange(val) {\r\n      this.pageSize = val;\r\n      this.getBlackList();\r\n    },\r\n\r\n    // 分页-切换页码\r\n    handleCurrentChange(val) {\r\n      this.pageNum = val;\r\n      this.getBlackList();\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.blacklist-container {\r\n  padding: 20px;\r\n  background-color: #f5f7fa;\r\n\r\n  .info-card {\r\n    border-radius: 12px;\r\n    overflow: hidden;\r\n\r\n    .card-header {\r\n      display: flex;\r\n      justify-content: space-between;\r\n      align-items: center;\r\n      padding: 16px 20px;\r\n      border-bottom: 1px solid #eee;\r\n      background-color: #fff;\r\n\r\n      h2 {\r\n        margin: 0;\r\n        font-size: 18px;\r\n        font-weight: 600;\r\n        color: #333;\r\n      }\r\n    }\r\n\r\n    .search-form {\r\n      padding: 20px;\r\n      background-color: #fff;\r\n      border-bottom: 1px solid #eee;\r\n    }\r\n\r\n    .table-container {\r\n      padding: 20px;\r\n      background-color: #fff;\r\n\r\n      .count-text {\r\n        color: #e6a23c;\r\n        font-weight: 600;\r\n      }\r\n\r\n      .detail-item {\r\n        line-height: 1.8;\r\n        font-size: 13px;\r\n        color: #666;\r\n      }\r\n\r\n      .plan-text {\r\n        color: #999;\r\n      }\r\n\r\n      .success-text {\r\n        color: #67c23a;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n.el-form-item {\r\n  margin-bottom: 15px;\r\n\r\n  .el-form-item__label {\r\n    color: #666;\r\n    font-weight: 500;\r\n  }\r\n\r\n  .el-input__inner,\r\n  .el-select__wrapper {\r\n    border-radius: 6px;\r\n    border-color: #dcdfe6;\r\n    transition: all 0.3s;\r\n\r\n    &:focus {\r\n      border-color: #409eff;\r\n      box-shadow: 0 0 0 2px rgba(64, 158, 255, 0.2);\r\n    }\r\n  }\r\n}\r\n\r\n.el-table {\r\n  --el-table-header-text-color: #666;\r\n  --el-table-row-hover-bg-color: #f8f9fa;\r\n\r\n  .el-table__header-wrapper {\r\n    th {\r\n      background-color: #f5f7fa;\r\n      font-weight: 500;\r\n    }\r\n  }\r\n}\r\n\r\n.el-pagination {\r\n  .el-pagination__sizes {\r\n    margin-right: 10px;\r\n  }\r\n\r\n  .el-pager li {\r\n    border-radius: 4px;\r\n    margin: 0 2px;\r\n  }\r\n\r\n  .el-pager li.active {\r\n    background-color: #409eff;\r\n    color: #fff;\r\n  }\r\n}\r\n</style>"]}]}