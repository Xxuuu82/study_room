{"remainingRequest":"D:\\3\\软件工程\\项目\\study_room\\src\\main\\resources\\front\\front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\3\\软件工程\\项目\\study_room\\src\\main\\resources\\front\\front\\src\\pages\\zixishi\\detail.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\3\\软件工程\\项目\\study_room\\src\\main\\resources\\front\\front\\src\\pages\\zixishi\\detail.vue","mtime":1765955158307},{"path":"D:\\3\\软件工程\\项目\\study_room\\src\\main\\resources\\front\\front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\3\\软件工程\\项目\\study_room\\src\\main\\resources\\front\\front\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\3\\软件工程\\项目\\study_room\\src\\main\\resources\\front\\front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\3\\软件工程\\项目\\study_room\\src\\main\\resources\\front\\front\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQpleHBvcnQgZGVmYXVsdCB7DQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIHRhYmxlbmFtZTogInppeGlzaGkiLA0KICAgICAgYmFzZVVybDogIiIsDQogICAgICBicmVhZGNydW1iSXRlbTogW3sgbmFtZTogIuiHquS5oOWupOivpuaDhSIgfV0sDQogICAgICBkZXRhaWxCYW5uZXI6IFtdLA0KICAgICAgZGV0YWlsOiB7fSwNCiAgICAgIHNlYXRzOiBudWxsLA0KICAgICAgbWF4U2VsZWN0OiAxLA0KICAgICAgc2VsZWN0ZWRTZWF0T2JqOiBudWxsLA0KICAgICAgYXZhaWxhYmlsaXR5RGlhbG9nOiBmYWxzZSwNCiAgICAgIGF2YWlsYWJpbGl0eURhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zbGljZSgwLDEwKSwNCiAgICAgIGF2YWlsYWJpbGl0eURhdGE6IG51bGwsDQogICAgICBhdmFpbGFiaWxpdHlTbG90czogW10sDQogICAgICBsb2FkaW5nU3RhdHVzOiBmYWxzZSwNCiAgICAgIC8vIGJ1dHRvbiBzdHlsZSB1c2VkIGluIHRlbXBsYXRlDQogICAgICBidXR0b25TdHlsZTogew0KICAgICAgICBib3JkZXI6ICcxcHggc29saWQgIzk3QzlENicsDQogICAgICAgIGN1cnNvcjogJ3BvaW50ZXInLA0KICAgICAgICBwYWRkaW5nOiAnMCAyNHB4JywNCiAgICAgICAgYm94U2hhZG93OiAnMHB4IDJweCAycHggMHB4ICM3OEFCQzMnLA0KICAgICAgICBvdXRsaW5lOiAnbm9uZScsDQogICAgICAgIGNvbG9yOiAnIzc4QUJDMycsDQogICAgICAgIGJvcmRlclJhZGl1czogJzMwcHgnLA0KICAgICAgICBiYWNrZ3JvdW5kOiAnI2ZmZicsDQogICAgICAgIGZvbnRTaXplOiAnMTRweCcsDQogICAgICAgIGhlaWdodDogJzQwcHgnLA0KICAgICAgICB0cmFuc2l0aW9uOiAnYWxsIDAuMnMnDQogICAgICB9LA0KICAgICAgYXZhaWxhYmlsaXR5Vmlld09ubHk6IHRydWUsIC8vIHRydWUgPSDku4Xmn6XnnIvvvIjngrnlh7vkuI3ot7PovazvvInvvJtmYWxzZSA9IOeCueWHu+S8mui3s+i9rOWIsOmihOe6pumhtemdou+8iOWOn+ihjOS4uu+8iQ0KICAgICAgaGlnaGxpZ2h0ZWRTbG90OiBudWxsLCAgICAgIC8vIOeUqOS6juWcqOS7heafpeeci+aooeW8j+S4i+mrmOS6rumAieS4reanvQ0KICAgICAgLy8g5paw5aKe77ya5pel5pyf6YCJ5oup5Zmo6YWN572u77yI5qC45b+D56aB55So6YC76L6R77yJDQogICAgICBkYXRlUGlja2VyT3B0aW9uczogew0KICAgICAgICBkaXNhYmxlZERhdGU6ICh0aW1lKSA9PiB7DQogICAgICAgICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpOw0KICAgICAgICAgIC8vIOa4heepuuaXtuWIhuenku+8jOS7heS/neeVmeW5tOaciOaXpQ0KICAgICAgICAgIGNvbnN0IHRvZGF5VGltZSA9IG5ldyBEYXRlKHRvZGF5LmdldEZ1bGxZZWFyKCksIHRvZGF5LmdldE1vbnRoKCksIHRvZGF5LmdldERhdGUoKSkuZ2V0VGltZSgpOw0KICAgICAgICAgIGNvbnN0IHRvbW9ycm93VGltZSA9IG5ldyBEYXRlKHRvZGF5LmdldEZ1bGxZZWFyKCksIHRvZGF5LmdldE1vbnRoKCksIHRvZGF5LmdldERhdGUoKSArIDEpLmdldFRpbWUoKTsNCiAgICAgICAgICBjb25zdCBjdXJyZW50VGltZSA9IG5ldyBEYXRlKHRpbWUuZ2V0RnVsbFllYXIoKSwgdGltZS5nZXRNb250aCgpLCB0aW1lLmdldERhdGUoKSkuZ2V0VGltZSgpOw0KICAgICAgICAgIC8vIOS7heWFgeiuuOS7iuWkqeWSjOaYjuWkqe+8jOWFtuS7luaXpeacn+emgeeUqA0KICAgICAgICAgIHJldHVybiBjdXJyZW50VGltZSAhPT0gdG9kYXlUaW1lICYmIGN1cnJlbnRUaW1lICE9PSB0b21vcnJvd1RpbWU7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9Ow0KICB9LA0KICBjb21wdXRlZDogew0KICAgIHNlbGVjdGVkU2VhdHNUZXh0KCkgew0KICAgICAgcmV0dXJuICh0aGlzLnNlYXRzICYmIHRoaXMuc2VhdHMuZmlsdGVyKHM9PnMuc2VsZWN0ZWQpLm1hcChzPT5zLm51bWJlcikuam9pbignLCAnKSkgfHwgJ+aaguaXoCc7DQogICAgfSwNCiAgICBjYW5TaG93QXZhaWxhYmlsaXR5QnV0dG9uKCkgew0KICAgICAgcmV0dXJuICEhdGhpcy5zZWxlY3RlZFNlYXRPYmo7DQogICAgfQ0KICB9LA0KICBjcmVhdGVkKCkgew0KICAgIHRoaXMuaW5pdCgpOw0KICAgIHRoaXMuaW5pdFNlYXRzKCk7DQogIH0sDQogIG1ldGhvZHM6IHsNCiAgICBnb0JhY2soKSB7IHRoaXMuJHJvdXRlci5wdXNoKCcvaW5kZXgveml4aXNoaScpOyB9LA0KICAgIGluaXQoKSB7DQogICAgICB0aGlzLmJhc2VVcmwgPSB0aGlzLiRjb25maWcgPyB0aGlzLiRjb25maWcuYmFzZVVybCA6ICcnOw0KICAgICAgaWYgKHRoaXMuJHJvdXRlICYmIHRoaXMuJHJvdXRlLnF1ZXJ5ICYmIHRoaXMuJHJvdXRlLnF1ZXJ5LmRldGFpbE9iaikgew0KICAgICAgICB0cnkgeyB0aGlzLmRldGFpbCA9IEpTT04ucGFyc2UodGhpcy4kcm91dGUucXVlcnkuZGV0YWlsT2JqKTsgfSBjYXRjaChlKXs7fQ0KICAgICAgfQ0KICAgICAgaWYgKHRoaXMuJHJvdXRlICYmIHRoaXMuJHJvdXRlLnF1ZXJ5ICYmIHRoaXMuJHJvdXRlLnF1ZXJ5LnN0b3JldXBPYmopIHsNCiAgICAgICAgdHJ5IHsgdGhpcy5kZXRhaWwuaWQgPSBKU09OLnBhcnNlKHRoaXMuJHJvdXRlLnF1ZXJ5LnN0b3JldXBPYmopLnJlZmlkOyB9IGNhdGNoKGUpezt9DQogICAgICB9DQogICAgICBpZiAodGhpcy5kZXRhaWwgJiYgdGhpcy5kZXRhaWwuaWQpIHsNCiAgICAgICAgdGhpcy4kaHR0cC5nZXQodGhpcy50YWJsZW5hbWUgKyAiL2RldGFpbC8iICsgdGhpcy5kZXRhaWwuaWQpLnRoZW4ocmVzPT57DQogICAgICAgICAgaWYgKHJlcy5kYXRhICYmIHJlcy5kYXRhLmNvZGUgPT09IDApIHsNCiAgICAgICAgICAgIHRoaXMuZGV0YWlsID0gcmVzLmRhdGEuZGF0YTsNCiAgICAgICAgICAgIHRoaXMuZGV0YWlsQmFubmVyID0gdGhpcy5kZXRhaWwudHVwaWFuID8gdGhpcy5kZXRhaWwudHVwaWFuLnNwbGl0KCcsJykgOiBbXTsNCiAgICAgICAgICB9DQogICAgICAgIH0pLmNhdGNoKCgpPT57fSk7DQogICAgICB9DQogICAgfSwNCiAgICBhc3luYyBpbml0U2VhdHMoKSB7DQogICAgICB0cnkgew0KICAgICAgICBpZiAoIXRoaXMuZGV0YWlsIHx8ICF0aGlzLmRldGFpbC5pZCkgeyB0aGlzLnNlYXRzID0gW107IHJldHVybjsgfQ0KICAgICAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLiRodHRwLmdldCh0aGlzLnRhYmxlbmFtZSArICIvc2VhdHMvIiArIHRoaXMuZGV0YWlsLmlkKTsNCiAgICAgICAgY29uc3QgZGJTZWF0cyA9IHJlcy5kYXRhOw0KICAgICAgICBjb25zdCBsaXN0ID0gQXJyYXkuaXNBcnJheShkYlNlYXRzKSA/IGRiU2VhdHMgOiAoZGJTZWF0cy5kYXRhICYmIEFycmF5LmlzQXJyYXkoZGJTZWF0cy5kYXRhKSA/IGRiU2VhdHMuZGF0YSA6IGRiU2VhdHMpOw0KICAgICAgICB0aGlzLnNlYXRzID0gbGlzdC5tYXAoc2VhdCA9PiAoeyBpZDogYHNlYXRfJHtzZWF0LmlkfWAsIG51bWJlcjogYCR7c2VhdC5pZH1gLCBzdGF0dXM6IE51bWJlcihzZWF0LnN0YXR1cyk9PT0xID8gJ2F2YWlsYWJsZScgOiAnb2NjdXBpZWQnLCBzZWxlY3RlZDpmYWxzZSB9KSk7DQogICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgIHRoaXMuc2VhdHMgPSBbXTsNCiAgICAgICAgY29uc29sZS5lcnJvcignaW5pdFNlYXRzIGVycm9yJywgZSk7DQogICAgICB9DQogICAgfSwNCiAgICBzZWF0U3R5bGUoc2VhdCkgew0KICAgICAgcmV0dXJuIHsNCiAgICAgICAgd2lkdGg6ICc0NXB4JywNCiAgICAgICAgaGVpZ2h0OiAnNDVweCcsDQogICAgICAgIGJvcmRlclJhZGl1czogJzhweCcsDQogICAgICAgIGN1cnNvcjogc2VhdC5zdGF0dXMgPT09ICdvY2N1cGllZCcgPyAnbm90LWFsbG93ZWQnIDogJ3BvaW50ZXInLA0KICAgICAgICBkaXNwbGF5OiAnZmxleCcsDQogICAgICAgIGFsaWduSXRlbXM6ICdjZW50ZXInLA0KICAgICAgICBqdXN0aWZ5Q29udGVudDogJ2NlbnRlcicsDQogICAgICAgIGZvbnRTaXplOiAnMTVweCcsDQogICAgICAgIGZvbnRXZWlnaHQ6ICc1MDAnLA0KICAgICAgICB0cmFuc2l0aW9uOiAnYWxsIDAuMnMgZWFzZS1pbi1vdXQnLA0KICAgICAgICBwb3NpdGlvbjogJ3JlbGF0aXZlJywNCiAgICAgICAgYm9yZGVyOiBzZWF0LnN0YXR1cyA9PT0gJ29jY3VwaWVkJyA/ICcycHggc29saWQgI2RjZGZlNicgOiAnMnB4IHNvbGlkICMyRTYxRTEnLA0KICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IHNlYXQuc2VsZWN0ZWQgPyAnIzJFNjFFMScgOiAoc2VhdC5zdGF0dXMgPT09ICdvY2N1cGllZCcgPyAnI2YwZjJmNScgOiAnI2ZmZicpLA0KICAgICAgICBjb2xvcjogc2VhdC5zZWxlY3RlZCA/ICcjZmZmJyA6IChzZWF0LnN0YXR1cyA9PT0gJ29jY3VwaWVkJyA/ICcjYzBjNGNjJyA6ICcjMzMzJykNCiAgICAgIH07DQogICAgfSwNCiAgICBoYW5kbGVTZWF0Q2xpY2soc2VhdCkgew0KICAgICAgaWYgKHNlYXQuc3RhdHVzID09PSAnb2NjdXBpZWQnKSB7IHRoaXMuJG1lc3NhZ2Uud2FybmluZygn6K+l5bqn5L2N5bey6KKr5Y2g55SoJyk7IHJldHVybjsgfQ0KICAgICAgY29uc3Qgc2VsZWN0ZWRDb3VudCA9IHRoaXMuc2VhdHMuZmlsdGVyKHM9PnMuc2VsZWN0ZWQpLmxlbmd0aDsNCiAgICAgIGNvbnN0IG5ld1NlYXRzID0gdGhpcy5zZWF0cy5tYXAocyA9PiB7DQogICAgICAgIGlmIChzLmlkID09PSBzZWF0LmlkKSB7DQogICAgICAgICAgaWYgKCFzLnNlbGVjdGVkICYmIHNlbGVjdGVkQ291bnQgPj0gdGhpcy5tYXhTZWxlY3QpIHsgdGhpcy4kbWVzc2FnZS53YXJuaW5nKGDmnIDlpJrpgInmi6kke3RoaXMubWF4U2VsZWN0feS4quW6p+S9jWApOyByZXR1cm4gczsgfQ0KICAgICAgICAgIHJldHVybiB7Li4ucywgc2VsZWN0ZWQ6ICFzLnNlbGVjdGVkfTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gczsNCiAgICAgIH0pOw0KICAgICAgdGhpcy5zZWF0cyA9IG5ld1NlYXRzOw0KICAgICAgY29uc3Qgc2VsZWN0ZWRzID0gdGhpcy5zZWF0cy5maWx0ZXIocz0+cy5zZWxlY3RlZCk7DQogICAgICB0aGlzLnNlbGVjdGVkU2VhdE9iaiA9IHNlbGVjdGVkcy5sZW5ndGggPT09IDEgPyBzZWxlY3RlZHNbMF0gOiBudWxsOw0KICAgIH0sDQogICAgb25BY3Jvc3MoYWNyb3NzVGFibGUpIHsNCiAgICAgIGNvbnN0IHNlbGVjdGVkU2VhdHMgPSB0aGlzLnNlYXRzLmZpbHRlcigocykgPT4gcy5zZWxlY3RlZCk7DQogICAgICBpZiAoc2VsZWN0ZWRTZWF0cy5sZW5ndGggPT09IDApIHsgdGhpcy4kbWVzc2FnZS5lcnJvcigi6K+35YWI6YCJ5oup5bqn5L2NIik7IHJldHVybjsgfQ0KICAgICAgdHJ5IHsNCiAgICAgICAgY29uc3Qgc3RvcmFnZURhdGEgPSB7DQogICAgICAgICAgdmVyc2lvbjogIjEuMCIsDQogICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLmdldFRpbWUoKSwNCiAgICAgICAgICBkYXRhOiB7DQogICAgICAgICAgICBzZWF0TnVtYmVyczogc2VsZWN0ZWRTZWF0cy5tYXAoKHMpID0+IHMubnVtYmVyKSwNCiAgICAgICAgICAgIHNlYXRJZHM6IHNlbGVjdGVkU2VhdHMubWFwKChzKSA9PiBzLmlkKSwNCiAgICAgICAgICAgIHppeGlzaGlJZDogdGhpcy5kZXRhaWwuaWQsDQogICAgICAgICAgfSwNCiAgICAgICAgfTsNCiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oInNlYXRTZWxlY3Rpb24iLCBidG9hKEpTT04uc3RyaW5naWZ5KHN0b3JhZ2VEYXRhKSkpOw0KICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgiY3Jvc3NUYWJsZSIsICJ6aXhpc2hpIik7DQogICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJjcm9zc09iaiIsIEpTT04uc3RyaW5naWZ5KHRoaXMuZGV0YWlsKSk7DQogICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICBjb25zb2xlLmVycm9yKCLmnKzlnLDlrZjlgqjlpLHotKU6IiwgZXJyb3IpOw0KICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCLmlbDmja7kv53lrZjlpLHotKXvvIzor7fmo4Dmn6XmtY/op4jlmajorr7nva4iKTsNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KICAgICAgdGhpcy4kcm91dGVyLnB1c2goeyBwYXRoOiBgL2luZGV4LyR7YWNyb3NzVGFibGV9QWRkYCwgcXVlcnk6IHsgdHlwZTogImNyb3NzIiwgc2VhdHM6IHNlbGVjdGVkU2VhdHMubWFwKHM9PnMuaWQpLmpvaW4oIiwiKSwgeml4aXNoaUlkOiB0aGlzLmRldGFpbC5pZCB9fSk7DQogICAgfSwNCiAgICBwYXJzZUtleXVlKGtzdHIpIHsNCiAgICAgIC8vIOWmguaenOWQjuerr+aciSBrZXl1ZXNoaWppYW4g5a2X5q615bm25LiU5qC85byP5q2j56Gu77yM5Y+v6Kej5p6Q5bm26L+U5Zue77ybDQogICAgICAvLyDlkKbliJnlvLrliLbov5Tlm54gIuW8gOaUvuaXtumXtO+8mjA4OjAwLTIyOjAwIg0KICAgICAgdHJ5IHsNCiAgICAgICAgaWYgKCFrc3RyKSByZXR1cm4gJ+WPr+e6puaXtumXtO+8mjA4OjAwLTIyOjAwJzsNCiAgICAgICAgY29uc3QgcyA9IGtzdHIucmVwbGFjZSgi77yaIiwgIjoiKS5yZXBsYWNlKCLoh7MiLCAiLSIpLnJlcGxhY2UoL+avj1vlpKnlkajmnIjlubRcc10qL2csICIiKS50cmltKCk7DQogICAgICAgIGlmIChzLmluZGV4T2YoIi0iKSA+PSAwKSB7DQogICAgICAgICAgY29uc3QgcGFydHMgPSBzLnNwbGl0KCItIik7DQogICAgICAgICAgcmV0dXJuICAn5Y+v57qm5pe26Ze0JytwYXJ0c1swXS50cmltKCkgKyAnLScgKyBwYXJ0c1sxXS50cmltKCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICflj6/nuqbml7bpl7TvvJowODowMC0yMjowMCc7DQogICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgIHJldHVybiAn5Y+v57qm5pe26Ze077yaMDg6MDAtMjI6MDAnOw0KICAgICAgfQ0KICAgIH0sDQogICAgb3BlbkF2YWlsYWJpbGl0eSgpIHsNCiAgICAgIGlmICghdGhpcy5zZWxlY3RlZFNlYXRPYmopIHsNCiAgICAgICAgdGhpcy4kbWVzc2FnZS53YXJuaW5nKCfor7flhYjpgInmi6nluqfkvY0nKTsNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KICAgICAgLy8g6buY6K6k5LuK5aSpDQogICAgICBpZiAoIXRoaXMuYXZhaWxhYmlsaXR5RGF0ZSkgdGhpcy5hdmFpbGFiaWxpdHlEYXRlID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNsaWNlKDAsMTApOw0KICAgICAgdGhpcy5hdmFpbGFiaWxpdHlEaWFsb2cgPSB0cnVlOw0KICAgICAgLy8g56uL5Y2z5p+l6K+i5pyA5paw5Y+v57qmL+W3suWNoOaVsOaNrg0KICAgICAgdGhpcy5mZXRjaFNlYXRTdGF0dXMoKTsNCiAgICB9LA0KDQogICAgYXN5bmMgZmV0Y2hTZWF0U3RhdHVzKCkgew0KICAgICAgaWYgKCF0aGlzLnNlbGVjdGVkU2VhdE9iaikgew0KICAgICAgICB0aGlzLiRtZXNzYWdlLndhcm5pbmcoJ+ivt+WFiOmAieaLqeW6p+S9jScpOw0KICAgICAgICByZXR1cm47DQogICAgICB9DQogICAgICB0aGlzLmxvYWRpbmdTdGF0dXMgPSB0cnVlOw0KICAgICAgY29uc3Qgeml4aXNoaWlkID0gTnVtYmVyKHRoaXMuZGV0YWlsLmlkKTsNCiAgICAgIGNvbnN0IHp1b3dlaSA9IHBhcnNlSW50KHRoaXMuc2VsZWN0ZWRTZWF0T2JqLm51bWJlciwgMTApOw0KICAgICAgLy8g56Gu5L+dIGRhdGUg5a2X56ym5LiyIHl5eXktTU0tZGQNCiAgICAgIGxldCBkYXRlID0gdGhpcy5hdmFpbGFiaWxpdHlEYXRlOw0KICAgICAgaWYgKCFkYXRlKSBkYXRlID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNsaWNlKDAsMTApOw0KICAgICAgZWxzZSBpZiAoZGF0ZSBpbnN0YW5jZW9mIERhdGUpIHsNCiAgICAgICAgY29uc3QgZCA9IGRhdGU7DQogICAgICAgIGRhdGUgPSBgJHtkLmdldEZ1bGxZZWFyKCl9LSR7KCcwJysoZC5nZXRNb250aCgpKzEpKS5zbGljZSgtMil9LSR7KCcwJytkLmdldERhdGUoKSkuc2xpY2UoLTIpfWA7DQogICAgICB9DQogICAgICB0cnkgew0KICAgICAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLiRheGlvcy5nZXQoJy95dXl1ZXhpbnhpL3NlYXQvbGlzdCcsIHsgcGFyYW1zOiB7IHppeGlzaGlpZCwgenVvd2VpLCBkYXRlIH19KQ0KICAgICAgICB0aGlzLmxvYWRpbmdTdGF0dXMgPSBmYWxzZTsNCiAgICAgICAgY29uc3QgcmVzQm9keSA9IHJlcy5ib2R5IHx8IHJlcy5kYXRhIHx8IHt9Ow0KICAgICAgICBsZXQgYm9va2luZ3MgPSBbXTsNCiAgICAgICAgaWYgKHJlc0JvZHkuY29kZSAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgaWYgKHJlc0JvZHkuY29kZSAhPT0gMCkgew0KICAgICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihyZXNCb2R5Lm1zZyB8fCAn6I635Y+W5Y+v57qm5pe26Ze05aSx6LSlJyk7DQogICAgICAgICAgICB0aGlzLmF2YWlsYWJpbGl0eVNsb3RzID0gW107DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgfQ0KICAgICAgICAgIGNvbnN0IGRhdGEgPSByZXNCb2R5LmRhdGEgfHwge307DQogICAgICAgICAgYm9va2luZ3MgPSBkYXRhLmJvb2tpbmdzIHx8IFtdOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGJvb2tpbmdzID0gQXJyYXkuaXNBcnJheShyZXNCb2R5KSA/IHJlc0JvZHkgOiAocmVzQm9keS5ib29raW5ncyB8fCBbXSk7DQogICAgICAgIH0NCiAgICAgICAgLy8g6L6T5Ye65omA5pyJYm9va2luZ+iusOW9lQ0KICAgICAgICBjb25zb2xlLmxvZygnZmV0Y2hTZWF0U3RhdHVzIGJvb2tpbmdzOicsIGJvb2tpbmdzKTsNCg0KICAgICAgICAvLyDmoLjlv4Pkv67mlLnvvJrnm7TmjqXln7rkuo7ljp/lp4tib29raW5nc+eUn+aIkHNsb3TvvIzliKDpmaTlsI/ml7bnuqfogZrlkIjpgLvovpENCiAgICAgICAgdGhpcy5hdmFpbGFiaWxpdHlTbG90cyA9IHRoaXMuX2J1aWxkMzBNaW5TbG90cyhkYXRlLCBib29raW5ncyk7DQoNCiAgICAgICAgLy8g55Sf5oiQYm9va2luZ0ludGVydmFsc++8iOS7heeUqOS6juiwg+ivle+8iQ0KICAgICAgICBjb25zdCBib29raW5nSW50ZXJ2YWxzID0gYm9va2luZ3MubWFwKGIgPT4gew0KICAgICAgICAgIGxldCBzdGFydFN0ciA9IGIueXV5dWVTdGFydCB8fCBiLnN0YXJ0U3RyIHx8IGIuc3RhcnQ7DQogICAgICAgICAgbGV0IGVuZFN0ciA9IGIueXV5dWVFbmQgICB8fCBiLmVuZFN0ciAgIHx8IGIuZW5kOw0KICAgICAgICAgIGNvbnN0IHMgPSBzdGFydFN0ciA/IG5ldyBEYXRlKHN0YXJ0U3RyKS5nZXRUaW1lKCkgOiBOYU47DQogICAgICAgICAgY29uc3QgZSA9IGVuZFN0ciAgID8gbmV3IERhdGUoZW5kU3RyKS5nZXRUaW1lKCkgICA6IE5hTjsNCiAgICAgICAgICByZXR1cm4geyBzdGFydDogcywgZW5kOiBlLCBzdGFydFN0ciwgZW5kU3RyIH07DQogICAgICAgIH0pOw0KICAgICAgICAvLyDovpPlh7rmiYDmnIlib29raW5nSW50ZXJ2YWxzDQogICAgICAgIGNvbnNvbGUubG9nKCdib29raW5nSW50ZXJ2YWxzOicsIGJvb2tpbmdJbnRlcnZhbHMpOw0KDQogICAgICAgIC8vIOaguOW/g+iwg+ivle+8mui+k+WHuuavj+S4qnNsb3TkuI7lhbbph43lj6DnmoRib29raW5nDQogICAgICAgIHRoaXMuYXZhaWxhYmlsaXR5U2xvdHMgPSB0aGlzLmF2YWlsYWJpbGl0eVNsb3RzLm1hcChzbG90ID0+IHsNCiAgICAgICAgICBjb25zdCBzbG90UyA9IG5ldyBEYXRlKHNsb3Quc3RhcnQpLmdldFRpbWUoKTsNCiAgICAgICAgICBjb25zdCBzbG90RSA9IG5ldyBEYXRlKHNsb3QuZW5kKS5nZXRUaW1lKCk7DQogICAgICAgICAgLy8g5Lil5qC86YeN5Y+g5Yik5pat6YC76L6RDQogICAgICAgICAgY29uc3Qgb3ZlcmxhcHBlZEJvb2tpbmdzID0gYm9va2luZ0ludGVydmFscy5maWx0ZXIoYmkgPT4NCiAgICAgICAgICAgICAgIWlzTmFOKGJpLnN0YXJ0KSAmJiAhaXNOYU4oYmkuZW5kKSAmJg0KICAgICAgICAgICAgICBzbG90UyA8IGJpLmVuZCAmJiBzbG90RSA+IGJpLnN0YXJ0DQogICAgICAgICAgKTsNCiAgICAgICAgICBjb25zdCBpc0Jvb2tlZCA9IG92ZXJsYXBwZWRCb29raW5ncy5sZW5ndGggPiAwOw0KDQogICAgICAgICAgLy8g5LuF6LCD6K+V6YeN54K55q6177ya6L6T5Ye6MTE6MzAtMTI6MDDmiJblhbblroPkvaDlhbPlv4PnmoTmrrUNCiAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgIHNsb3Quc3RhcnRTdHIuaW5jbHVkZXMoIjEwOjMwIikgfHwNCiAgICAgICAgICAgICAgc2xvdC5zdGFydFN0ci5pbmNsdWRlcygiMTE6MDAiKSB8fA0KICAgICAgICAgICAgICBzbG90LnN0YXJ0U3RyLmluY2x1ZGVzKCIxMTozMCIpIHx8DQogICAgICAgICAgICAgIHNsb3Quc3RhcnRTdHIuaW5jbHVkZXMoIjEyOjAwIikgfHwNCiAgICAgICAgICAgICAgc2xvdC5zdGFydFN0ci5pbmNsdWRlcygiMTI6MzAiKSB8fA0KICAgICAgICAgICAgICBzbG90LnN0YXJ0U3RyLmluY2x1ZGVzKCIxNDowMCIpIHx8DQogICAgICAgICAgICAgIHNsb3Quc3RhcnRTdHIuaW5jbHVkZXMoIjE0OjMwIikNCiAgICAgICAgICApIHsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKA0KICAgICAgICAgICAgICAgIGBbREVCVUddIHNsb3QgJHtzbG90LnN0YXJ0U3RyfSB+ICR7c2xvdC5lbmRTdHJ9IHwgaXNCb29rZWQ6ICR7aXNCb29rZWR9YCwNCiAgICAgICAgICAgICAgICB7IG92ZXJsYXBwZWRCb29raW5ncyB9DQogICAgICAgICAgICApOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIHJldHVybiB7DQogICAgICAgICAgICAuLi5zbG90LA0KICAgICAgICAgICAgc3RhdHVzOiBpc0Jvb2tlZCA/ICdvY2N1cGllZCcgOiBzbG90LnN0YXR1cw0KICAgICAgICAgIH07DQogICAgICAgIH0pOw0KDQogICAgICAgIGNvbnNvbGUubG9nKA0KICAgICAgICAgICAgJ+acgOe7iDE0OjMwLTE1OjAwc2xvdDonLA0KICAgICAgICAgICAgdGhpcy5hdmFpbGFiaWxpdHlTbG90cy5maW5kKHMgPT4gcy5zdGFydFN0ci5pbmNsdWRlcygnMTQ6MzAnKSkNCiAgICAgICAgKTsNCiAgICAgIH0gY2F0Y2ggKGVycikgew0KICAgICAgICB0aGlzLmxvYWRpbmdTdGF0dXMgPSBmYWxzZTsNCiAgICAgICAgY29uc29sZS5lcnJvcignZmV0Y2hTZWF0U3RhdHVzIGVycm9yJywgZXJyKTsNCiAgICAgICAgY29uc3Qgc3RhdHVzID0gZXJyICYmIChlcnIuc3RhdHVzIHx8IChlcnIucmVzcG9uc2UgJiYgZXJyLnJlc3BvbnNlLnN0YXR1cykpOw0KICAgICAgICBpZiAoc3RhdHVzID09PSA0MDApIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+ivt+axguWPguaVsOmUmeivryAoNDAwKScpOw0KICAgICAgICBlbHNlIGlmIChzdGF0dXMgPT09IDQwNCkgdGhpcy4kbWVzc2FnZS5lcnJvcign5o6l5Y+j5pyq5om+5YiwICg0MDQpJyk7DQogICAgICAgIGVsc2UgdGhpcy4kbWVzc2FnZS5lcnJvcign572R57uc5byC5bi477yM5peg5rOV6L+e5o6l5ZCO56uvJyk7DQogICAgICAgIHRoaXMuYXZhaWxhYmlsaXR5U2xvdHMgPSBbXTsNCiAgICAgIH0NCiAgICB9LA0KDQogICAgLy8g5qC45b+D5L+u5pS577ya6YeN5p6EX2J1aWxkMzBNaW5TbG90c++8jOebtOaOpeWfuuS6juWOn+Wni+mihOe6puiusOW9leWIpOaWre+8jOWIoOmZpOWwj+aXtue6p+iBmuWQiOmAu+i+kQ0KICAgIF9idWlsZDMwTWluU2xvdHMoZGF0ZVN0ciwgYm9va2luZ3MsIGdyYW51bGFyaXR5ID0gMzApIHsNCiAgICAgIGNvbnN0IHNsb3RzID0gW107DQogICAgICBjb25zdCBkYXlTdGFydEhvdXIgPSA4Ow0KICAgICAgY29uc3QgZGF5RW5kSG91ciA9IDIyOw0KICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTsNCiAgICAgIGNvbnN0IGlzVG9kYXkgPSBkYXRlU3RyID09PSBub3cudG9JU09TdHJpbmcoKS5zbGljZSgwLDEwKTsNCiAgICAgIGNvbnN0IHBhcnRzID0gZGF0ZVN0ci5zcGxpdCgnLScpOw0KICAgICAgY29uc3QgeWVhciA9IE51bWJlcihwYXJ0c1swXSk7DQogICAgICBjb25zdCBtb250aCA9IE51bWJlcihwYXJ0c1sxXSkgLSAxOw0KICAgICAgY29uc3QgZGF5ID0gTnVtYmVyKHBhcnRzWzJdKTsNCg0KICAgICAgLy8g6L2s5o2i6aKE57qm6K6w5b2V5Li65pe26Ze05oiz5Yy66Ze0DQogICAgICBjb25zdCBib29raW5nSW50ZXJ2YWxzID0gYm9va2luZ3MubWFwKGIgPT4gew0KICAgICAgICBjb25zdCBzdGFydCA9IG5ldyBEYXRlKGIueXV5dWVTdGFydCB8fCBiLnN0YXJ0U3RyIHx8IGIuc3RhcnQpLmdldFRpbWUoKTsNCiAgICAgICAgY29uc3QgZW5kID0gbmV3IERhdGUoYi55dXl1ZUVuZCB8fCBiLmVuZFN0ciB8fCBiLmVuZCkuZ2V0VGltZSgpOw0KICAgICAgICByZXR1cm4geyBzdGFydCwgZW5kIH07DQogICAgICB9KS5maWx0ZXIoYmkgPT4gIWlzTmFOKGJpLnN0YXJ0KSAmJiAhaXNOYU4oYmkuZW5kKSk7DQoNCiAgICAgIGZvciAobGV0IGggPSBkYXlTdGFydEhvdXI7IGggPCBkYXlFbmRIb3VyOyBoKyspIHsNCiAgICAgICAgY29uc3Qgc3RlcHNQZXJIb3VyID0gTWF0aC5mbG9vcig2MCAvIGdyYW51bGFyaXR5KTsNCiAgICAgICAgZm9yIChsZXQgc3RlcCA9IDA7IHN0ZXAgPCBzdGVwc1BlckhvdXI7IHN0ZXArKykgew0KICAgICAgICAgIGNvbnN0IG1pbnV0ZSA9IHN0ZXAgKiBncmFudWxhcml0eTsNCiAgICAgICAgICBjb25zdCBzdGFydERhdGUgPSBuZXcgRGF0ZSh5ZWFyLCBtb250aCwgZGF5LCBoLCBtaW51dGUsIDApOw0KICAgICAgICAgIGNvbnN0IGVuZERhdGUgPSBuZXcgRGF0ZShzdGFydERhdGUuZ2V0VGltZSgpICsgZ3JhbnVsYXJpdHkgKiA2MCAqIDEwMDApOw0KICAgICAgICAgIGNvbnN0IHNsb3RTdGFydCA9IHN0YXJ0RGF0ZS5nZXRUaW1lKCk7DQogICAgICAgICAgY29uc3Qgc2xvdEVuZCA9IGVuZERhdGUuZ2V0VGltZSgpOw0KDQogICAgICAgICAgLy8gMS4g6buY6K6k6YO95piv5Y+v57qmDQogICAgICAgICAgbGV0IHN0YXR1cyA9ICdhdmFpbGFibGUnOw0KDQogICAgICAgICAgLy8gMi4g5Yik5pat5piv5ZCm5LiO5Y6f5aeL6aKE57qm5pyJ5Lil5qC85Lqk6ZuG77yI5bem6Zet5Y+z5byA77yJDQogICAgICAgICAgY29uc3QgaXNCb29rZWQgPSBib29raW5nSW50ZXJ2YWxzLnNvbWUoYmkgPT4gc2xvdFN0YXJ0IDwgYmkuZW5kICYmIHNsb3RFbmQgPiBiaS5zdGFydCk7DQogICAgICAgICAgaWYgKGlzQm9va2VkKSBzdGF0dXMgPSAnb2NjdXBpZWQnOw0KDQogICAgICAgICAgLy8gMy4g5bey6L+H5pe26Ze05Yik5pat77ya5LuF5b2T5b2T5YmN5pe26Ze0IOKJpSBzbG905byA5aeL5pe26Ze05omN566X5bey6L+HDQogICAgICAgICAgY29uc3QgaXNQYXN0ID0gaXNUb2RheSAmJiBub3cuZ2V0VGltZSgpID49IHNsb3RTdGFydDsNCiAgICAgICAgICBpZiAoaXNQYXN0KSBzdGF0dXMgPSAnb2NjdXBpZWQnOw0KDQogICAgICAgICAgc2xvdHMucHVzaCh7DQogICAgICAgICAgICBzdGFydDogc3RhcnREYXRlLA0KICAgICAgICAgICAgZW5kOiBlbmREYXRlLA0KICAgICAgICAgICAgc3RhcnRTdHI6IHRoaXMuX3RvRGF0ZVN0cihzbG90U3RhcnQpLA0KICAgICAgICAgICAgZW5kU3RyOiB0aGlzLl90b0RhdGVTdHIoc2xvdEVuZCksDQogICAgICAgICAgICBzdGF0dXMsDQogICAgICAgICAgICBpc1Bhc3QNCiAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcmV0dXJuIHNsb3RzOw0KICAgIH0sDQoNCiAgICBmb3JtYXRTbG90VGl0bGUoc2xvdCkgew0KICAgICAgcmV0dXJuIGAke3Nsb3Quc3RhcnRTdHJ9IOKGkiAke3Nsb3QuZW5kU3RyfSAgJHtzbG90LnN0YXR1cyA9PT0gJ2F2YWlsYWJsZScgJiYgIXNsb3QuaXNQYXN0ID8gJ+WPr+e6picgOiAoc2xvdC5pc1Bhc3QgPyAn5bey6L+HJyA6ICflt7LljaAnKX1gOw0KICAgIH0sDQoNCiAgICBvblNsb3RDbGljayhzbG90KSB7DQogICAgICBpZiAoc2xvdC5zdGF0dXMgIT09ICdhdmFpbGFibGUnIHx8IHNsb3QuaXNQYXN0KSB7DQogICAgICAgIHRoaXMuJG1lc3NhZ2UuaW5mbygn6K+l5pe25q615LiN5Y+v6aKE57qmJyk7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCiAgICAgIGlmICh0aGlzLmF2YWlsYWJpbGl0eVZpZXdPbmx5KSB7DQogICAgICAgIC8vIOS7heafpeeci++8mumrmOS6ru+8jOaYvuekuuaPkOekuu+8jOS4jei3s+i9rA0KICAgICAgICB0aGlzLmhpZ2hsaWdodGVkU2xvdCA9IHNsb3Quc3RhcnRTdHIgKyAn4oaSJyArIHNsb3QuZW5kU3RyOw0KICAgICAgICB0aGlzLiRtZXNzYWdlKHsgbWVzc2FnZTogYOafpeeci+aXtuaute+8miR7dGhpcy5mb3JtYXRUaW1lU2hvcnQoc2xvdC5zdGFydFN0cil9IC0gJHt0aGlzLmZvcm1hdFRpbWVTaG9ydChzbG90LmVuZFN0cil9YCwgdHlwZTogJ2luZm8nLCBkdXJhdGlvbjogMTUwMCB9KTsNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgLy8g5pen6YC76L6R77ya6YCJ5Lit5bm26Lez6L2s5Yiw6aKE57qm6aG16Z2i77yI5L+d5oyB5Y6f6KGM5Li677yJDQogICAgICAgIGNvbnN0IHBpY2sgPSB7IHN0YXJ0OiBzbG90LnN0YXJ0U3RyLCBlbmQ6IHNsb3QuZW5kU3RyLCB6aXhpc2hpSWQ6IHRoaXMuZGV0YWlsLmlkLCB6dW93ZWk6IHRoaXMuc2VsZWN0ZWRTZWF0T2JqLm51bWJlciB9Ow0KICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnYXZhaWxhYmlsaXR5U2VsZWN0aW9uJywgSlNPTi5zdHJpbmdpZnkocGljaykpOw0KICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoJ+W3sumAieaXtuaute+8jOato+WcqOi3s+i9rOWIsOmihOe6pumhtemdoicpOw0KICAgICAgICB0aGlzLmF2YWlsYWJpbGl0eURpYWxvZyA9IGZhbHNlOw0KICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7IHBhdGg6ICcvaW5kZXgveXV5dWV4aW54aUFkZCcsIHF1ZXJ5OiB7IHR5cGU6ICdjcm9zcycgfSB9KTsNCiAgICAgIH0NCiAgICB9LA0KDQogICAgLy8g5L+d55WZ6K+l5pa55rOV5L2G5LiN5YaN5L2/55So77yI6YG/5YWN5Yig6Zmk5a+86Ie05YW25LuW5byV55So5oql6ZSZ77yJDQogICAgX2J1aWxkQXZhaWxhYmlsaXR5RnJvbVJlc2VydmF0aW9ucyhkYXRlU3RyLCByZXNlcnZlZExpc3QpIHsNCiAgICAgIGNvbnN0IG9wZW5TdGFydCA9ICcwODowMCc7DQogICAgICBjb25zdCBvcGVuRW5kID0gJzIyOjAwJzsNCiAgICAgIGNvbnN0IGhvdXJzID0gW107DQogICAgICBmb3IgKGxldCBoID0gODsgaCA8IDIyOyBoKyspIGhvdXJzLnB1c2goeyBob3VyOiBoLCBpc0Jvb2tlZDogZmFsc2UgfSk7DQogICAgICBpZiAoQXJyYXkuaXNBcnJheShyZXNlcnZlZExpc3QpKSB7DQogICAgICAgIHJlc2VydmVkTGlzdC5mb3JFYWNoKGl0ZW0gPT4gew0KICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICBjb25zdCBzID0gbmV3IERhdGUoaXRlbS55dXl1ZVN0YXJ0KTsNCiAgICAgICAgICAgIGNvbnN0IGUgPSBuZXcgRGF0ZShpdGVtLnl1eXVlRW5kKTsNCiAgICAgICAgICAgIGZvciAobGV0IGggPSA4OyBoIDwgMjI7IGgrKykgew0KICAgICAgICAgICAgICBjb25zdCBzbG90U3RhcnQgPSBuZXcgRGF0ZShkYXRlU3RyICsgJyAnICsgKCgnMCcraCkuc2xpY2UoLTIpICsgJzowMDowMCcpKTsNCiAgICAgICAgICAgICAgY29uc3Qgc2xvdEVuZCA9IG5ldyBEYXRlKGRhdGVTdHIgKyAnICcgKyAoKCcwJysoaCsxKSkuc2xpY2UoLTIpICsgJzowMDowMCcpKTsNCiAgICAgICAgICAgICAgaWYgKGUgPiBzbG90U3RhcnQgJiYgcyA8IHNsb3RFbmQpIHsNCiAgICAgICAgICAgICAgICBjb25zdCBpZHggPSBoIC0gODsNCiAgICAgICAgICAgICAgICBpZiAoaG91cnNbaWR4XSkgaG91cnNbaWR4XS5pc0Jvb2tlZCA9IHRydWU7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9IGNhdGNoIChlKSB7fQ0KICAgICAgICB9KTsNCiAgICAgIH0NCiAgICAgIGNvbnN0IGludGVydmFscyA9IFtdOw0KICAgICAgbGV0IGN1ciA9IG51bGw7DQogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGhvdXJzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgIGNvbnN0IGggPSBob3Vyc1tpXTsNCiAgICAgICAgY29uc3Qgc3RhdHVzID0gaC5pc0Jvb2tlZCA/ICdvY2N1cGllZCcgOiAnYXZhaWxhYmxlJzsNCiAgICAgICAgY29uc3Qgc2VnU3RhcnRIb3VyID0gOCArIGk7DQogICAgICAgIGNvbnN0IHNlZ1N0YXJ0U3RyID0gYCR7ZGF0ZVN0cn0gJHsoJzAnK3NlZ1N0YXJ0SG91cikuc2xpY2UoLTIpfTowMDowMGA7DQogICAgICAgIGNvbnN0IHNlZ0VuZFN0ciA9IGAke2RhdGVTdHJ9ICR7KCcwJysoc2VnU3RhcnRIb3VyKzEpKS5zbGljZSgtMil9OjAwOjAwYDsNCiAgICAgICAgaWYgKCFjdXIpIGN1ciA9IHsgc3RhdHVzLCBzdGFydFN0cjogc2VnU3RhcnRTdHIsIGVuZFN0cjogc2VnRW5kU3RyIH07DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgIGlmIChjdXIuc3RhdHVzID09PSBzdGF0dXMpIGN1ci5lbmRTdHIgPSBzZWdFbmRTdHI7DQogICAgICAgICAgZWxzZSB7IGludGVydmFscy5wdXNoKGN1cik7IGN1ciA9IHsgc3RhdHVzLCBzdGFydFN0cjogc2VnU3RhcnRTdHIsIGVuZFN0cjogc2VnRW5kU3RyIH07IH0NCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgaWYgKGN1cikgaW50ZXJ2YWxzLnB1c2goY3VyKTsNCiAgICAgIHJldHVybiB7IGRhdGU6IGRhdGVTdHIsIG9wZW5TdGFydCwgb3BlbkVuZCwgaW50ZXJ2YWxzIH07DQogICAgfSwNCg0KICAgIF90b0RhdGVTdHIodHMpIHsNCiAgICAgIGlmICghdHMpIHJldHVybiAnJzsNCiAgICAgIGNvbnN0IGQgPSBuZXcgRGF0ZShOdW1iZXIodHMpKTsNCiAgICAgIGNvbnN0IFkgPSBkLmdldEZ1bGxZZWFyKCk7DQogICAgICBjb25zdCBNID0gKCcwJysoZC5nZXRNb250aCgpKzEpKS5zbGljZSgtMik7DQogICAgICBjb25zdCBEID0gKCcwJytkLmdldERhdGUoKSkuc2xpY2UoLTIpOw0KICAgICAgY29uc3QgaCA9ICgnMCcrZC5nZXRIb3VycygpKS5zbGljZSgtMik7DQogICAgICBjb25zdCBtID0gKCcwJytkLmdldE1pbnV0ZXMoKSkuc2xpY2UoLTIpOw0KICAgICAgY29uc3QgcyA9ICgnMCcrZC5nZXRTZWNvbmRzKCkpLnNsaWNlKC0yKTsNCiAgICAgIHJldHVybiBgJHtZfS0ke019LSR7RH0gJHtofToke219OiR7c31gOw0KICAgIH0sDQoNCiAgICBmb3JtYXRUaW1lU2hvcnQoZnVsbFN0cikgew0KICAgICAgaWYgKCFmdWxsU3RyKSByZXR1cm4gJyc7DQogICAgICBjb25zdCBtID0gZnVsbFN0ci5tYXRjaCgvXGR7Mn06XGR7Mn0oOlxkezJ9KT8kLyk7DQogICAgICByZXR1cm4gbSA/IG1bMF0uc2xpY2UoMCw1KSA6IGZ1bGxTdHI7DQogICAgfSwNCg0KICAgIGlzQXV0aCgpIHsgcmV0dXJuIHRydWU7IH0sDQoNCiAgICBfdGltZVN0ckZyb21EYXRlKGQpIHsNCiAgICAgIGNvbnN0IGhoID0gKCcwJytkLmdldEhvdXJzKCkpLnNsaWNlKC0yKTsNCiAgICAgIGNvbnN0IG1tID0gKCcwJytkLmdldE1pbnV0ZXMoKSkuc2xpY2UoLTIpOw0KICAgICAgcmV0dXJuIGAke2hofToke21tfWA7DQogICAgfSwNCg0KICAgIF9hZGRNaW51dGVzVG9UaW1lU3RyKHRpbWVTdHIsIGFkZE1pbikgew0KICAgICAgaWYgKCF0aW1lU3RyKSByZXR1cm4gdGltZVN0cjsNCiAgICAgIGNvbnN0IHBhcnRzID0gdGltZVN0ci5zcGxpdCgnOicpOw0KICAgICAgY29uc3QgZCA9IG5ldyBEYXRlKCk7DQogICAgICBkLnNldEhvdXJzKHBhcnNlSW50KHBhcnRzWzBdLDEwKSwgcGFyc2VJbnQocGFydHNbMV0sMTApLCAwLCAwKTsNCiAgICAgIGQuc2V0TWludXRlcyhkLmdldE1pbnV0ZXMoKSArIGFkZE1pbik7DQogICAgICByZXR1cm4gKCcwJytkLmdldEhvdXJzKCkpLnNsaWNlKC0yKSArICc6JyArICgnMCcrZC5nZXRNaW51dGVzKCkpLnNsaWNlKC0yKTsNCiAgICB9LA0KDQogICAgdHVwaWFuVXBsb2FkQ2hhbmdlKGZpbGVVcmxzKSB7IHRoaXMuZGV0YWlsLnR1cGlhbiA9IGZpbGVVcmxzLnJlcGxhY2UobmV3IFJlZ0V4cCh0aGlzLiRjb25maWc/LmJhc2VVcmwgfHwgJycsICJnIiksICIiKTsgfQ0KICB9DQp9Ow0K"},{"version":3,"sources":["detail.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA","file":"detail.vue","sourceRoot":"src/pages/zixishi","sourcesContent":["<template>\r\n  <div style=\"width: 100%; min-height: 100vh; padding: 0 10px; boxSizing: border-box; background: #bfd2fc;\">\r\n    <!-- 面包屑（和列表页风格统一） -->\r\n    <div :style='{\"width\":\"100%\",\"padding\":\"20px\",\"margin\":\"10px auto\",\"borderRadius\":\"27px\",\"background\":\"#bfd2fc\"}' class=\"breadcrumb-preview\">\r\n      <el-breadcrumb :separator=\"'Ξ'\" :style='{\"fontSize\":\"14px\",\"lineHeight\":\"1\"}'>\r\n        <el-breadcrumb-item>首页</el-breadcrumb-item>\r\n        <el-breadcrumb-item v-for=\"(item, index) in breadcrumbItem\" :key=\"index\">{{item.name}}</el-breadcrumb-item>\r\n      </el-breadcrumb>\r\n    </div>\r\n    <!-- 详情容器（全屏自适应） -->\r\n    <div class=\"detail-preview\" :style='{\r\n      width: \"100%\",\r\n      margin: \"20px auto\",\r\n      position: \"relative\",\r\n      background: \"#fff\",\r\n      boxShadow: \"0px 4px 10px 0px rgba(0,0,0,0.302)\",\r\n      borderRadius: \"8px\",\r\n      boxSizing: \"border-box\",\r\n      padding: \"20px\"\r\n    }'>\r\n      <!-- 基础信息模块 -->\r\n      <div class=\"attr\" :style=\"{\r\n        padding: '20px',\r\n        position: 'relative',\r\n        background: '#f8f9fa',\r\n        borderRadius: '8px',\r\n        display: 'flex',\r\n        flexWrap: 'wrap',\r\n        gap: '20px',\r\n        marginBottom: '20px'\r\n      }\">\r\n        <!-- 轮播图 -->\r\n        <el-carousel\r\n            :style=\"{ flex: '1 1 400px', minWidth: '300px', height: '400px', borderRadius: '8px', overflow: 'hidden' }\"\r\n            :autoplay=\"true\"\r\n            trigger=\"click\"\r\n            indicator-position=\"inside\"\r\n            arrow=\"always\"\r\n            :loop=\"true\"\r\n            :interval=\"3000\"\r\n        >\r\n          <el-carousel-item v-for=\"(item, idx) in detailBanner\" :key=\"idx\" :style=\"{ borderRadius: '8px', width: '100%', height: '100%' }\">\r\n            <el-image\r\n                v-if=\"item && item.substr && item.substr(0,4) === 'http'\"\r\n                :src=\"item\"\r\n                fit=\"cover\"\r\n                :style=\"{ objectFit: 'cover', width: '100%', height: '100%' }\"\r\n            />\r\n            <el-image\r\n                v-else\r\n                :src=\"baseUrl + item\"\r\n                fit=\"cover\"\r\n                :style=\"{ objectFit: 'cover', width: '100%', height: '100%' }\"\r\n            />\r\n          </el-carousel-item>\r\n        </el-carousel>\r\n        <!-- 信息面板 -->\r\n        <div class=\"info\" :style=\"{ flex: '2 1 500px', minWidth: '300px', padding: '20px', background: '#fff', borderRadius: '8px', boxShadow: '0 2px 8px rgba(0,0,0,0.1)'}\">\r\n          <div class=\"item\" :style=\"{ padding: '10px 0', margin: '0 0 20px 0', alignItems: 'center', justifyContent: 'space-between', display: 'flex', borderBottom: '1px solid #eee' }\">\r\n            <div :style=\"{ color: '#333', fontSize: '18px', fontWeight: '500' }\">{{ detail.mingcheng }}</div>\r\n          </div>\r\n          <div style=\"display: grid; gridTemplateColumns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;\">\r\n            <div class=\"info-item\" :style=\"{ padding: '12px', background: '#f8f9fa', borderRadius: '6px' }\">\r\n              <div :style=\"{ color: '#999', fontSize: '13px', marginBottom: '4px' }\">规模</div>\r\n              <div :style=\"{ color: '#333', fontSize: '14px', fontWeight: '400' }\">{{ detail.guimo || '暂无' }}</div>\r\n            </div>\r\n            <div class=\"info-item\" :style=\"{ padding: '12px', background: '#f8f9fa', borderRadius: '6px' }\">\r\n              <div :style=\"{ color: '#999', fontSize: '13px', marginBottom: '4px' }\">座位</div>\r\n              <div :style=\"{ color: '#333', fontSize: '14px', fontWeight: '400' }\">{{ detail.sd_zuowei || '暂无' }}</div>\r\n            </div>\r\n            <div class=\"info-item\" :style=\"{ padding: '12px', background: '#f8f9fa', borderRadius: '6px' }\">\r\n              <div :style=\"{ color: '#999', fontSize: '13px', marginBottom: '4px' }\">位置</div>\r\n              <div :style=\"{ color: '#333', fontSize: '14px', fontWeight: '400' }\">{{ detail.weizhi || '暂无' }}</div>\r\n            </div>\r\n            <div class=\"info-item\" :style=\"{ padding: '12px', background: '#f8f9fa', borderRadius: '6px' }\">\r\n              <div :style=\"{ color: '#999', fontSize: '13px', marginBottom: '4px' }\">开放时间</div>\r\n              <div :style=\"{ color: '#333', fontSize: '14px', fontWeight: '400' }\">{{ parseKeyue(detail.keyueshijian) }}</div>\r\n            </div>\r\n          </div>\r\n          <div class=\"btn\" :style=\"{ padding: '20px 0 10px', justifyContent: 'center', display: 'flex' }\">\r\n            <el-button v-if=\"isAuth('zixishi','在线预约')\" type=\"success\" @click=\"onAcross('yuyuexinxi')\" :style=\"buttonStyle\">在线预约</el-button>\r\n            <el-button v-if=\"canShowAvailabilityButton\" type=\"primary\" @click=\"openAvailability\" :style=\"buttonStyle\">可约时间</el-button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <!-- 座位选择模块 -->\r\n      <div class=\"seat-map\" :style=\"{ padding: '30px', margin: '0 0 20px 0', background: '#f8f9fa', borderRadius: '8px', boxShadow: '0 2px 8px rgba(0,0,0,0.1)', position: 'relative' }\">\r\n        <div class=\"seat-header\" :style=\"{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px', flexWrap: 'wrap', gap: '10px' }\">\r\n          <div class=\"seat-title\" :style=\"{ fontSize: '16px', color: '#333', fontWeight: '500', paddingBottom: '10px', borderBottom: '1px solid #eee', flex: '1 1 100%' }\">座位选择</div>\r\n          <div class=\"seat-legend\" :style=\"{ display: 'flex', gap: '20px', fontSize: '13px', color: '#666' }\">\r\n            <div :style=\"{display: 'flex', alignItems: 'center', gap: '6px'}\">\r\n              <div :style=\"{ width: '16px', height: '16px', border: '2px solid #2E61E1', borderRadius: '4px', background: '#fff' }\"></div>\r\n              <span>可选座位</span>\r\n            </div>\r\n            <div :style=\"{display: 'flex', alignItems: 'center', gap: '6px'}\">\r\n              <div :style=\"{ width: '16px', height: '16px', border: '2px solid #2E61E1', borderRadius: '4px', background: '#2E61E1', boxShadow: '0 0 0 2px rgba(46, 97, 225, 0.3)' }\"></div>\r\n              <span>已选座位</span>\r\n            </div>\r\n            <div :style=\"{display: 'flex', alignItems: 'center', gap: '6px'}\">\r\n              <div :style=\"{ width: '16px', height: '16px', border: '2px solid #dcdfe6', borderRadius: '4px', background: '#f0f2f5' }\"></div>\r\n              <span>维护中</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div v-if=\"seats\" class=\"seat-grid\" :style=\"{ display: 'grid', gap: '15px', gridTemplateColumns: 'repeat(auto-fill, minmax(45px, 1fr))', justifyItems: 'center', maxWidth: '900px', margin: '0 auto', padding: '20px', background: '#fff', borderRadius: '8px', boxShadow: '0 1px 3px rgba(0,0,0,0.05)'}\">\r\n          <div v-for=\"seat in seats\" :key=\"seat.id\" class=\"seat-item\"\r\n               :class=\"{ 'seat-selected': seat.selected, 'seat-occupied': seat.status === 'occupied', 'seat-available': seat.status === 'available' }\"\r\n               @click=\"handleSeatClick(seat)\"\r\n               :style=\"seatStyle(seat)\">\r\n            {{ seat.number }}\r\n            <i v-if=\"seat.status === 'occupied'\" class=\"el-icon-lock\" :style=\"{ position: 'absolute', bottom: '2px', right: '2px', fontSize: '10px', color: '#c0c4cc' }\"></i>\r\n          </div>\r\n        </div>\r\n        <div class=\"selected-hint\" v-if=\"seats\" :style=\"{ marginTop: '20px', color: '#666', fontSize: '14px', textAlign: 'center', padding: '10px', background: '#fff', borderRadius: '6px', maxWidth: '500px', margin: '0 auto' }\">\r\n          <i class=\"el-icon-info\" :style=\"{color: '#2E61E1', marginRight: '6px'}\"></i>\r\n          已选座位：<span style=\"color: #2e61e1; font-weight: 500;\">{{ selectedSeatsText }}</span>\r\n          <span style=\"margin-left: 10px; color: #999;\">（最多选择{{ maxSelect }}个座位）</span>\r\n        </div>\r\n        <div v-else style=\"padding: 20px; color: #666; text-align: center;\">加载座位信息中...</div>\r\n      </div>\r\n      <!-- 返回按钮 -->\r\n      <div style=\"width: 100%; display: flex; justify-content: center; margin: 30px 0 20px;\">\r\n        <el-button @click=\"goBack\" :style=\"buttonStyle\"><i class=\"el-icon-arrow-left\" style=\"margin-right:6px;\"></i>返回自习室列表</el-button>\r\n      </div>\r\n    </div>\r\n    <!-- 可约时间弹窗 -->\r\n    <el-dialog title=\"可约时间\" :visible.sync=\"availabilityDialog\" width=\"900px\">\r\n      <div style=\"display:flex; gap:12px; align-items:center; margin-bottom:12px;\">\r\n        <!-- 核心修改：日期选择器绑定picker-options + 自定义类名 -->\r\n        <el-date-picker\r\n            v-model=\"availabilityDate\"\r\n            type=\"date\"\r\n            placeholder=\"选择日期(默认今日)\"\r\n            style=\"width:200px;\"\r\n            :picker-options=\"datePickerOptions\"\r\n            value-format=\"yyyy-MM-dd\"\r\n            popper-class=\"custom-availability-date-picker\"\r\n        >\r\n        </el-date-picker>\r\n        <el-button type=\"primary\" @click=\"fetchSeatStatus\">查询</el-button>\r\n        <div style=\"margin-left: auto; color: #666;\">已选座位：<span style=\"color:#2E61E1; font-weight:500\">{{ selectedSeatsText }}</span></div>\r\n      </div>\r\n      <div v-if=\"availabilitySlots && availabilitySlots.length\" style=\"padding:12px; background:#fff; border-radius:6px; border:1px solid #eee;\">\r\n        <div style=\"display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;\">\r\n          <div style=\"font-size:14px; color:#666;\">显示：{{ availabilityDate }} （08:00 - 22:00，共 {{ availabilitySlots.length }} 槽）</div>\r\n          <div style=\"font-size:12px; color:#999;\">绿色=可约，灰色=已占或已过</div>\r\n        </div>\r\n        <div class=\"availability-grid\">\r\n          <div\r\n              v-for=\"slot in availabilitySlots\"\r\n              :key=\"slot.startStr\"\r\n              :class=\"['slot', slot.status, { 'slot-past': slot.isPast }]\"\r\n              @click=\"onSlotClick(slot)\"\r\n              :title=\"formatSlotTitle(slot)\"\r\n          >\r\n            <div class=\"slot-time\">{{ formatTimeShort(slot.startStr) }} - {{ formatTimeShort(slot.endStr) }}</div>\r\n            <div class=\"slot-label\">{{ slot.status === 'available' && !slot.isPast ? '可约' : (slot.isPast ? '已过' : '已占') }}</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div v-else style=\"padding: 20px; color: #666;\">暂无可约数据，或请先选择座位并点击 查询。</div>\r\n      <span slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"availabilityDialog=false\">关闭</el-button>\r\n      </span>\r\n      <el-button type=\"text\" @click=\"fetchSeatStatus\">刷新</el-button>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      tablename: \"zixishi\",\r\n      baseUrl: \"\",\r\n      breadcrumbItem: [{ name: \"自习室详情\" }],\r\n      detailBanner: [],\r\n      detail: {},\r\n      seats: null,\r\n      maxSelect: 1,\r\n      selectedSeatObj: null,\r\n      availabilityDialog: false,\r\n      availabilityDate: new Date().toISOString().slice(0,10),\r\n      availabilityData: null,\r\n      availabilitySlots: [],\r\n      loadingStatus: false,\r\n      // button style used in template\r\n      buttonStyle: {\r\n        border: '1px solid #97C9D6',\r\n        cursor: 'pointer',\r\n        padding: '0 24px',\r\n        boxShadow: '0px 2px 2px 0px #78ABC3',\r\n        outline: 'none',\r\n        color: '#78ABC3',\r\n        borderRadius: '30px',\r\n        background: '#fff',\r\n        fontSize: '14px',\r\n        height: '40px',\r\n        transition: 'all 0.2s'\r\n      },\r\n      availabilityViewOnly: true, // true = 仅查看（点击不跳转）；false = 点击会跳转到预约页面（原行为）\r\n      highlightedSlot: null,      // 用于在仅查看模式下高亮选中槽\r\n      // 新增：日期选择器配置（核心禁用逻辑）\r\n      datePickerOptions: {\r\n        disabledDate: (time) => {\r\n          const today = new Date();\r\n          // 清空时分秒，仅保留年月日\r\n          const todayTime = new Date(today.getFullYear(), today.getMonth(), today.getDate()).getTime();\r\n          const tomorrowTime = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 1).getTime();\r\n          const currentTime = new Date(time.getFullYear(), time.getMonth(), time.getDate()).getTime();\r\n          // 仅允许今天和明天，其他日期禁用\r\n          return currentTime !== todayTime && currentTime !== tomorrowTime;\r\n        }\r\n      }\r\n    };\r\n  },\r\n  computed: {\r\n    selectedSeatsText() {\r\n      return (this.seats && this.seats.filter(s=>s.selected).map(s=>s.number).join(', ')) || '暂无';\r\n    },\r\n    canShowAvailabilityButton() {\r\n      return !!this.selectedSeatObj;\r\n    }\r\n  },\r\n  created() {\r\n    this.init();\r\n    this.initSeats();\r\n  },\r\n  methods: {\r\n    goBack() { this.$router.push('/index/zixishi'); },\r\n    init() {\r\n      this.baseUrl = this.$config ? this.$config.baseUrl : '';\r\n      if (this.$route && this.$route.query && this.$route.query.detailObj) {\r\n        try { this.detail = JSON.parse(this.$route.query.detailObj); } catch(e){;}\r\n      }\r\n      if (this.$route && this.$route.query && this.$route.query.storeupObj) {\r\n        try { this.detail.id = JSON.parse(this.$route.query.storeupObj).refid; } catch(e){;}\r\n      }\r\n      if (this.detail && this.detail.id) {\r\n        this.$http.get(this.tablename + \"/detail/\" + this.detail.id).then(res=>{\r\n          if (res.data && res.data.code === 0) {\r\n            this.detail = res.data.data;\r\n            this.detailBanner = this.detail.tupian ? this.detail.tupian.split(',') : [];\r\n          }\r\n        }).catch(()=>{});\r\n      }\r\n    },\r\n    async initSeats() {\r\n      try {\r\n        if (!this.detail || !this.detail.id) { this.seats = []; return; }\r\n        const res = await this.$http.get(this.tablename + \"/seats/\" + this.detail.id);\r\n        const dbSeats = res.data;\r\n        const list = Array.isArray(dbSeats) ? dbSeats : (dbSeats.data && Array.isArray(dbSeats.data) ? dbSeats.data : dbSeats);\r\n        this.seats = list.map(seat => ({ id: `seat_${seat.id}`, number: `${seat.id}`, status: Number(seat.status)===1 ? 'available' : 'occupied', selected:false }));\r\n      } catch (e) {\r\n        this.seats = [];\r\n        console.error('initSeats error', e);\r\n      }\r\n    },\r\n    seatStyle(seat) {\r\n      return {\r\n        width: '45px',\r\n        height: '45px',\r\n        borderRadius: '8px',\r\n        cursor: seat.status === 'occupied' ? 'not-allowed' : 'pointer',\r\n        display: 'flex',\r\n        alignItems: 'center',\r\n        justifyContent: 'center',\r\n        fontSize: '15px',\r\n        fontWeight: '500',\r\n        transition: 'all 0.2s ease-in-out',\r\n        position: 'relative',\r\n        border: seat.status === 'occupied' ? '2px solid #dcdfe6' : '2px solid #2E61E1',\r\n        backgroundColor: seat.selected ? '#2E61E1' : (seat.status === 'occupied' ? '#f0f2f5' : '#fff'),\r\n        color: seat.selected ? '#fff' : (seat.status === 'occupied' ? '#c0c4cc' : '#333')\r\n      };\r\n    },\r\n    handleSeatClick(seat) {\r\n      if (seat.status === 'occupied') { this.$message.warning('该座位已被占用'); return; }\r\n      const selectedCount = this.seats.filter(s=>s.selected).length;\r\n      const newSeats = this.seats.map(s => {\r\n        if (s.id === seat.id) {\r\n          if (!s.selected && selectedCount >= this.maxSelect) { this.$message.warning(`最多选择${this.maxSelect}个座位`); return s; }\r\n          return {...s, selected: !s.selected};\r\n        }\r\n        return s;\r\n      });\r\n      this.seats = newSeats;\r\n      const selecteds = this.seats.filter(s=>s.selected);\r\n      this.selectedSeatObj = selecteds.length === 1 ? selecteds[0] : null;\r\n    },\r\n    onAcross(acrossTable) {\r\n      const selectedSeats = this.seats.filter((s) => s.selected);\r\n      if (selectedSeats.length === 0) { this.$message.error(\"请先选择座位\"); return; }\r\n      try {\r\n        const storageData = {\r\n          version: \"1.0\",\r\n          timestamp: new Date().getTime(),\r\n          data: {\r\n            seatNumbers: selectedSeats.map((s) => s.number),\r\n            seatIds: selectedSeats.map((s) => s.id),\r\n            zixishiId: this.detail.id,\r\n          },\r\n        };\r\n        localStorage.setItem(\"seatSelection\", btoa(JSON.stringify(storageData)));\r\n        localStorage.setItem(\"crossTable\", \"zixishi\");\r\n        localStorage.setItem(\"crossObj\", JSON.stringify(this.detail));\r\n      } catch (error) {\r\n        console.error(\"本地存储失败:\", error);\r\n        this.$message.error(\"数据保存失败，请检查浏览器设置\");\r\n        return;\r\n      }\r\n      this.$router.push({ path: `/index/${acrossTable}Add`, query: { type: \"cross\", seats: selectedSeats.map(s=>s.id).join(\",\"), zixishiId: this.detail.id }});\r\n    },\r\n    parseKeyue(kstr) {\r\n      // 如果后端有 keyueshijian 字段并且格式正确，可解析并返回；\r\n      // 否则强制返回 \"开放时间：08:00-22:00\"\r\n      try {\r\n        if (!kstr) return '可约时间：08:00-22:00';\r\n        const s = kstr.replace(\"：\", \":\").replace(\"至\", \"-\").replace(/每[天周月年\\s]*/g, \"\").trim();\r\n        if (s.indexOf(\"-\") >= 0) {\r\n          const parts = s.split(\"-\");\r\n          return  '可约时间'+parts[0].trim() + '-' + parts[1].trim();\r\n        }\r\n        return '可约时间：08:00-22:00';\r\n      } catch (e) {\r\n        return '可约时间：08:00-22:00';\r\n      }\r\n    },\r\n    openAvailability() {\r\n      if (!this.selectedSeatObj) {\r\n        this.$message.warning('请先选择座位');\r\n        return;\r\n      }\r\n      // 默认今天\r\n      if (!this.availabilityDate) this.availabilityDate = new Date().toISOString().slice(0,10);\r\n      this.availabilityDialog = true;\r\n      // 立即查询最新可约/已占数据\r\n      this.fetchSeatStatus();\r\n    },\r\n\r\n    async fetchSeatStatus() {\r\n      if (!this.selectedSeatObj) {\r\n        this.$message.warning('请先选择座位');\r\n        return;\r\n      }\r\n      this.loadingStatus = true;\r\n      const zixishiid = Number(this.detail.id);\r\n      const zuowei = parseInt(this.selectedSeatObj.number, 10);\r\n      // 确保 date 字符串 yyyy-MM-dd\r\n      let date = this.availabilityDate;\r\n      if (!date) date = new Date().toISOString().slice(0,10);\r\n      else if (date instanceof Date) {\r\n        const d = date;\r\n        date = `${d.getFullYear()}-${('0'+(d.getMonth()+1)).slice(-2)}-${('0'+d.getDate()).slice(-2)}`;\r\n      }\r\n      try {\r\n        const res = await this.$axios.get('/yuyuexinxi/seat/list', { params: { zixishiid, zuowei, date }})\r\n        this.loadingStatus = false;\r\n        const resBody = res.body || res.data || {};\r\n        let bookings = [];\r\n        if (resBody.code !== undefined) {\r\n          if (resBody.code !== 0) {\r\n            this.$message.error(resBody.msg || '获取可约时间失败');\r\n            this.availabilitySlots = [];\r\n            return;\r\n          }\r\n          const data = resBody.data || {};\r\n          bookings = data.bookings || [];\r\n        } else {\r\n          bookings = Array.isArray(resBody) ? resBody : (resBody.bookings || []);\r\n        }\r\n        // 输出所有booking记录\r\n        console.log('fetchSeatStatus bookings:', bookings);\r\n\r\n        // 核心修改：直接基于原始bookings生成slot，删除小时级聚合逻辑\r\n        this.availabilitySlots = this._build30MinSlots(date, bookings);\r\n\r\n        // 生成bookingIntervals（仅用于调试）\r\n        const bookingIntervals = bookings.map(b => {\r\n          let startStr = b.yuyueStart || b.startStr || b.start;\r\n          let endStr = b.yuyueEnd   || b.endStr   || b.end;\r\n          const s = startStr ? new Date(startStr).getTime() : NaN;\r\n          const e = endStr   ? new Date(endStr).getTime()   : NaN;\r\n          return { start: s, end: e, startStr, endStr };\r\n        });\r\n        // 输出所有bookingIntervals\r\n        console.log('bookingIntervals:', bookingIntervals);\r\n\r\n        // 核心调试：输出每个slot与其重叠的booking\r\n        this.availabilitySlots = this.availabilitySlots.map(slot => {\r\n          const slotS = new Date(slot.start).getTime();\r\n          const slotE = new Date(slot.end).getTime();\r\n          // 严格重叠判断逻辑\r\n          const overlappedBookings = bookingIntervals.filter(bi =>\r\n              !isNaN(bi.start) && !isNaN(bi.end) &&\r\n              slotS < bi.end && slotE > bi.start\r\n          );\r\n          const isBooked = overlappedBookings.length > 0;\r\n\r\n          // 仅调试重点段：输出11:30-12:00或其它你关心的段\r\n          if (\r\n              slot.startStr.includes(\"10:30\") ||\r\n              slot.startStr.includes(\"11:00\") ||\r\n              slot.startStr.includes(\"11:30\") ||\r\n              slot.startStr.includes(\"12:00\") ||\r\n              slot.startStr.includes(\"12:30\") ||\r\n              slot.startStr.includes(\"14:00\") ||\r\n              slot.startStr.includes(\"14:30\")\r\n          ) {\r\n            console.log(\r\n                `[DEBUG] slot ${slot.startStr} ~ ${slot.endStr} | isBooked: ${isBooked}`,\r\n                { overlappedBookings }\r\n            );\r\n          }\r\n\r\n          return {\r\n            ...slot,\r\n            status: isBooked ? 'occupied' : slot.status\r\n          };\r\n        });\r\n\r\n        console.log(\r\n            '最终14:30-15:00slot:',\r\n            this.availabilitySlots.find(s => s.startStr.includes('14:30'))\r\n        );\r\n      } catch (err) {\r\n        this.loadingStatus = false;\r\n        console.error('fetchSeatStatus error', err);\r\n        const status = err && (err.status || (err.response && err.response.status));\r\n        if (status === 400) this.$message.error('请求参数错误 (400)');\r\n        else if (status === 404) this.$message.error('接口未找到 (404)');\r\n        else this.$message.error('网络异常，无法连接后端');\r\n        this.availabilitySlots = [];\r\n      }\r\n    },\r\n\r\n    // 核心修改：重构_build30MinSlots，直接基于原始预约记录判断，删除小时级聚合逻辑\r\n    _build30MinSlots(dateStr, bookings, granularity = 30) {\r\n      const slots = [];\r\n      const dayStartHour = 8;\r\n      const dayEndHour = 22;\r\n      const now = new Date();\r\n      const isToday = dateStr === now.toISOString().slice(0,10);\r\n      const parts = dateStr.split('-');\r\n      const year = Number(parts[0]);\r\n      const month = Number(parts[1]) - 1;\r\n      const day = Number(parts[2]);\r\n\r\n      // 转换预约记录为时间戳区间\r\n      const bookingIntervals = bookings.map(b => {\r\n        const start = new Date(b.yuyueStart || b.startStr || b.start).getTime();\r\n        const end = new Date(b.yuyueEnd || b.endStr || b.end).getTime();\r\n        return { start, end };\r\n      }).filter(bi => !isNaN(bi.start) && !isNaN(bi.end));\r\n\r\n      for (let h = dayStartHour; h < dayEndHour; h++) {\r\n        const stepsPerHour = Math.floor(60 / granularity);\r\n        for (let step = 0; step < stepsPerHour; step++) {\r\n          const minute = step * granularity;\r\n          const startDate = new Date(year, month, day, h, minute, 0);\r\n          const endDate = new Date(startDate.getTime() + granularity * 60 * 1000);\r\n          const slotStart = startDate.getTime();\r\n          const slotEnd = endDate.getTime();\r\n\r\n          // 1. 默认都是可约\r\n          let status = 'available';\r\n\r\n          // 2. 判断是否与原始预约有严格交集（左闭右开）\r\n          const isBooked = bookingIntervals.some(bi => slotStart < bi.end && slotEnd > bi.start);\r\n          if (isBooked) status = 'occupied';\r\n\r\n          // 3. 已过时间判断：仅当当前时间 ≥ slot开始时间才算已过\r\n          const isPast = isToday && now.getTime() >= slotStart;\r\n          if (isPast) status = 'occupied';\r\n\r\n          slots.push({\r\n            start: startDate,\r\n            end: endDate,\r\n            startStr: this._toDateStr(slotStart),\r\n            endStr: this._toDateStr(slotEnd),\r\n            status,\r\n            isPast\r\n          });\r\n        }\r\n      }\r\n      return slots;\r\n    },\r\n\r\n    formatSlotTitle(slot) {\r\n      return `${slot.startStr} → ${slot.endStr}  ${slot.status === 'available' && !slot.isPast ? '可约' : (slot.isPast ? '已过' : '已占')}`;\r\n    },\r\n\r\n    onSlotClick(slot) {\r\n      if (slot.status !== 'available' || slot.isPast) {\r\n        this.$message.info('该时段不可预约');\r\n        return;\r\n      }\r\n      if (this.availabilityViewOnly) {\r\n        // 仅查看：高亮，显示提示，不跳转\r\n        this.highlightedSlot = slot.startStr + '→' + slot.endStr;\r\n        this.$message({ message: `查看时段：${this.formatTimeShort(slot.startStr)} - ${this.formatTimeShort(slot.endStr)}`, type: 'info', duration: 1500 });\r\n        return;\r\n      } else {\r\n        // 旧逻辑：选中并跳转到预约页面（保持原行为）\r\n        const pick = { start: slot.startStr, end: slot.endStr, zixishiId: this.detail.id, zuowei: this.selectedSeatObj.number };\r\n        localStorage.setItem('availabilitySelection', JSON.stringify(pick));\r\n        this.$message.success('已选时段，正在跳转到预约页面');\r\n        this.availabilityDialog = false;\r\n        this.$router.push({ path: '/index/yuyuexinxiAdd', query: { type: 'cross' } });\r\n      }\r\n    },\r\n\r\n    // 保留该方法但不再使用（避免删除导致其他引用报错）\r\n    _buildAvailabilityFromReservations(dateStr, reservedList) {\r\n      const openStart = '08:00';\r\n      const openEnd = '22:00';\r\n      const hours = [];\r\n      for (let h = 8; h < 22; h++) hours.push({ hour: h, isBooked: false });\r\n      if (Array.isArray(reservedList)) {\r\n        reservedList.forEach(item => {\r\n          try {\r\n            const s = new Date(item.yuyueStart);\r\n            const e = new Date(item.yuyueEnd);\r\n            for (let h = 8; h < 22; h++) {\r\n              const slotStart = new Date(dateStr + ' ' + (('0'+h).slice(-2) + ':00:00'));\r\n              const slotEnd = new Date(dateStr + ' ' + (('0'+(h+1)).slice(-2) + ':00:00'));\r\n              if (e > slotStart && s < slotEnd) {\r\n                const idx = h - 8;\r\n                if (hours[idx]) hours[idx].isBooked = true;\r\n              }\r\n            }\r\n          } catch (e) {}\r\n        });\r\n      }\r\n      const intervals = [];\r\n      let cur = null;\r\n      for (let i = 0; i < hours.length; i++) {\r\n        const h = hours[i];\r\n        const status = h.isBooked ? 'occupied' : 'available';\r\n        const segStartHour = 8 + i;\r\n        const segStartStr = `${dateStr} ${('0'+segStartHour).slice(-2)}:00:00`;\r\n        const segEndStr = `${dateStr} ${('0'+(segStartHour+1)).slice(-2)}:00:00`;\r\n        if (!cur) cur = { status, startStr: segStartStr, endStr: segEndStr };\r\n        else {\r\n          if (cur.status === status) cur.endStr = segEndStr;\r\n          else { intervals.push(cur); cur = { status, startStr: segStartStr, endStr: segEndStr }; }\r\n        }\r\n      }\r\n      if (cur) intervals.push(cur);\r\n      return { date: dateStr, openStart, openEnd, intervals };\r\n    },\r\n\r\n    _toDateStr(ts) {\r\n      if (!ts) return '';\r\n      const d = new Date(Number(ts));\r\n      const Y = d.getFullYear();\r\n      const M = ('0'+(d.getMonth()+1)).slice(-2);\r\n      const D = ('0'+d.getDate()).slice(-2);\r\n      const h = ('0'+d.getHours()).slice(-2);\r\n      const m = ('0'+d.getMinutes()).slice(-2);\r\n      const s = ('0'+d.getSeconds()).slice(-2);\r\n      return `${Y}-${M}-${D} ${h}:${m}:${s}`;\r\n    },\r\n\r\n    formatTimeShort(fullStr) {\r\n      if (!fullStr) return '';\r\n      const m = fullStr.match(/\\d{2}:\\d{2}(:\\d{2})?$/);\r\n      return m ? m[0].slice(0,5) : fullStr;\r\n    },\r\n\r\n    isAuth() { return true; },\r\n\r\n    _timeStrFromDate(d) {\r\n      const hh = ('0'+d.getHours()).slice(-2);\r\n      const mm = ('0'+d.getMinutes()).slice(-2);\r\n      return `${hh}:${mm}`;\r\n    },\r\n\r\n    _addMinutesToTimeStr(timeStr, addMin) {\r\n      if (!timeStr) return timeStr;\r\n      const parts = timeStr.split(':');\r\n      const d = new Date();\r\n      d.setHours(parseInt(parts[0],10), parseInt(parts[1],10), 0, 0);\r\n      d.setMinutes(d.getMinutes() + addMin);\r\n      return ('0'+d.getHours()).slice(-2) + ':' + ('0'+d.getMinutes()).slice(-2);\r\n    },\r\n\r\n    tupianUploadChange(fileUrls) { this.detail.tupian = fileUrls.replace(new RegExp(this.$config?.baseUrl || '', \"g\"), \"\"); }\r\n  }\r\n};\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n/* 原有样式保持不变 */\r\n.availability-grid {\r\n  display: grid;\r\n  grid-template-columns: repeat(6, 1fr);\r\n  gap: 8px;\r\n}\r\n.slot {\r\n  border-radius: 6px;\r\n  padding: 8px;\r\n  text-align: center;\r\n  cursor: pointer;\r\n  user-select: none;\r\n  border: 1px solid #e6e6e6;\r\n}\r\n.slot .slot-time { font-size: 13px; color: #fff; font-weight: 600; }\r\n.slot .slot-label { font-size: 12px; color: #fff; margin-top: 4px; }\r\n/* online-style for available slot: mimic the \"在线预约\" button */\r\n.slot.available {\r\n  background: #fff !important;\r\n  border: 2px solid #97C9D6 !important; /* same border as online button */\r\n  color: #78ABC3 !important;            /* text color like your online button */\r\n  border-radius: 30px !important;\r\n  box-shadow: 0 2px 6px rgba(120,138,195,0.08) !important;\r\n  padding: 12px 6px !important;\r\n  cursor: pointer;\r\n}\r\n/* hover effect to be slightly filled */\r\n.slot.available:hover {\r\n  background: linear-gradient(180deg, rgba(120,138,195,0.06), rgba(120,138,195,0.02)) !important;\r\n  transform: translateY(-2px);\r\n}\r\n/* small text style inside slot */\r\n.slot .slot-time { font-size: 13px; color: inherit; font-weight: 600; }\r\n.slot .slot-label { font-size: 12px; color: inherit; }\r\n/* occupied/past remain gray and disabled */\r\n.slot.occupied, .slot-past {\r\n  background: #f0f2f5 !important;\r\n  border-color: #e6e6e6 !important;\r\n  color: #999 !important;\r\n  cursor: not-allowed;\r\n  box-shadow: none !important;\r\n}\r\n.slot.occupied { background: #f0f2f5; border-color: #e6e6e6; color: #999; cursor: not-allowed; }\r\n.slot-past { background: #f5f7fa; border-color: #eaeef5; color: #bbb; cursor: not-allowed; }\r\n@media (max-width: 768px) {\r\n  .availability-grid { grid-template-columns: repeat(3, 1fr); }\r\n}\r\n</style>\r\n<!-- 全局样式：强制控制日期选择器禁用样式（必须无scoped） -->\r\n<style lang=\"scss\">\r\n/* 定位自定义类名的日期选择器弹出层 */\r\n.custom-availability-date-picker {\r\n  /* 禁用日期的核心样式：变灰+删除线+禁止点击 */\r\n  .el-date-table td.disabled {\r\n    pointer-events: none !important; /* 彻底禁止点击 */\r\n    .cell {\r\n      background-color: #f5f5f5 !important; /* 灰色背景 */\r\n      color: #c0c4cc !important; /* 灰色文字 */\r\n      text-decoration: line-through !important; /* 删除线 */\r\n      text-decoration-color: #999 !important; /* 删除线颜色 */\r\n      opacity: 1 !important; /* 取消透明，确保样式清晰 */\r\n    }\r\n  }\r\n  /* 确保可选日期样式正常 */\r\n  .el-date-table td:not(.disabled) .cell {\r\n    text-decoration: none !important;\r\n    background-color: transparent !important;\r\n    color: #333 !important;\r\n  }\r\n  /* 高亮今天/明天的可选日期 */\r\n  .el-date-table td.is-today .cell {\r\n    background-color: #f0f5ff !important;\r\n    color: #2e61e1 !important;\r\n    font-weight: 600;\r\n  }\r\n}\r\n</style>"]}]}